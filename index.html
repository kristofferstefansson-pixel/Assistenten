<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#0a0a08">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="AI Assistent">
<title>AI Assistent</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYmciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMWExYTEwIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzBhMGEwOCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ29sZCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmN2Q3NzQiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmNWM4NDIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojYzg5NjBhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJyaW5nIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4zIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4wNSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9Imdsb3ciPgogICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI4IiByZXN1bHQ9ImJsdXIiLz4KICAgICAgPGZlTWVyZ2U+PGZlTWVyZ2VOb2RlIGluPSJibHVyIi8+PGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+PC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgPC9kZWZzPgogIAogIDwhLS0gQmFja2dyb3VuZCAtLT4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjExMCIgZmlsbD0idXJsKCNiZykiLz4KICAKICA8IS0tIE91dGVyIHJpbmcgZ2xvdyAtLT4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ1cmwoI3JpbmcpIiBzdHJva2Utd2lkdGg9IjEuNSIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTk1IiBmaWxsPSJub25lIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4yIi8+CiAgCiAgPCEtLSBTdWJ0bGUgZ3JpZCBsaW5lcyAtLT4KICA8bGluZSB4MT0iODAiIHkxPSIyNTYiIHgyPSI0MzIiIHkyPSIyNTYiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZS1vcGFjaXR5PSIwLjA4Ii8+CiAgPGxpbmUgeDE9IjI1NiIgeTE9IjgwIiB4Mj0iMjU2IiB5Mj0iNDMyIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4wOCIvPgoKICA8IS0tIElubmVyIGNpcmNsZSBiYWNrZ3JvdW5kIC0tPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTc1IiBmaWxsPSIjMTMxMzEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxNzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2Utb3BhY2l0eT0iMC4xNSIvPgoKICA8IS0tIEJpdGNvaW4gQiBzeW1ib2wgLSBib2xkLCBzaGFycCwgbW9kZXJuIC0tPgogIDwhLS0gTGVmdCB2ZXJ0aWNhbCBiYXIgLS0+CiAgPHJlY3QgeD0iMTc4IiB5PSIxNDUiIHdpZHRoPSIzMiIgaGVpZ2h0PSIyMjIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIiBmaWx0ZXI9InVybCgjZ2xvdykiLz4KICAKICA8IS0tIFRvcCBidW1wIC0tPgogIDxyZWN0IHg9IjE3OCIgeT0iMTQ1IiB3aWR0aD0iOTgiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIyNDAiIHdpZHRoPSIxMTAiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIzMzUiIHdpZHRoPSI5OCIgaGVpZ2h0PSIzMiIgcng9IjYiIGZpbGw9InVybCgjZ29sZCkiLz4KICAKICA8IS0tIFRvcCBhcmMgLS0+CiAgPHBhdGggZD0iTSAyNzYgMTQ1IFEgMzQwIDE0NSAzNDAgMTk5IFEgMzQwIDI0MCAyNzYgMjQwIiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBCb3R0b20gYXJjIChzbGlnaHRseSB3aWRlcikgLS0+CiAgPHBhdGggZD0iTSAyODggMjQwIFEgMzU4IDI0MCAzNTggMjk1IFEgMzU4IDM2NyAyODggMzY3IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBUb3Agc2VyaWYgbGluZXMgKGNsYXNzaWMgQml0Y29pbiBzdHlsZSkgLS0+CiAgPHJlY3QgeD0iMjAyIiB5PSIxMjUiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KICA8cmVjdCB4PSIyNDgiIHk9IjEyNSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjI4IiByeD0iNCIgZmlsbD0idXJsKCNnb2xkKSIvPgogIDwhLS0gQm90dG9tIHNlcmlmIGxpbmVzIC0tPgogIDxyZWN0IHg9IjIwMiIgeT0iMzU5IiB3aWR0aD0iMjAiIGhlaWdodD0iMjgiIHJ4PSI0IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMjQ4IiB5PSIzNTkiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KCiAgPCEtLSBDb3JuZXIgZG90cyAvIGRlY29yYXRpdmUgLS0+CiAgPGNpcmNsZSBjeD0iMTI4IiBjeT0iMTI4IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgogIDxjaXJjbGUgY3g9IjM4NCIgY3k9IjEyOCIgcj0iNCIgZmlsbD0iI2Y1Yzg0MiIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KICA8Y2lyY2xlIGN4PSIxMjgiIGN5PSIzODQiIHI9IjQiIGZpbGw9IiNmNWM4NDIiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iMzg0IiBjeT0iMzg0IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgo8L3N2Zz4=">
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYmciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMWExYTEwIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzBhMGEwOCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ29sZCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmN2Q3NzQiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmNWM4NDIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojYzg5NjBhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJyaW5nIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4zIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4wNSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9Imdsb3ciPgogICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI4IiByZXN1bHQ9ImJsdXIiLz4KICAgICAgPGZlTWVyZ2U+PGZlTWVyZ2VOb2RlIGluPSJibHVyIi8+PGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+PC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgPC9kZWZzPgogIAogIDwhLS0gQmFja2dyb3VuZCAtLT4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjExMCIgZmlsbD0idXJsKCNiZykiLz4KICAKICA8IS0tIE91dGVyIHJpbmcgZ2xvdyAtLT4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ1cmwoI3JpbmcpIiBzdHJva2Utd2lkdGg9IjEuNSIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTk1IiBmaWxsPSJub25lIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4yIi8+CiAgCiAgPCEtLSBTdWJ0bGUgZ3JpZCBsaW5lcyAtLT4KICA8bGluZSB4MT0iODAiIHkxPSIyNTYiIHgyPSI0MzIiIHkyPSIyNTYiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZS1vcGFjaXR5PSIwLjA4Ii8+CiAgPGxpbmUgeDE9IjI1NiIgeTE9IjgwIiB4Mj0iMjU2IiB5Mj0iNDMyIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4wOCIvPgoKICA8IS0tIElubmVyIGNpcmNsZSBiYWNrZ3JvdW5kIC0tPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTc1IiBmaWxsPSIjMTMxMzEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxNzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2Utb3BhY2l0eT0iMC4xNSIvPgoKICA8IS0tIEJpdGNvaW4gQiBzeW1ib2wgLSBib2xkLCBzaGFycCwgbW9kZXJuIC0tPgogIDwhLS0gTGVmdCB2ZXJ0aWNhbCBiYXIgLS0+CiAgPHJlY3QgeD0iMTc4IiB5PSIxNDUiIHdpZHRoPSIzMiIgaGVpZ2h0PSIyMjIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIiBmaWx0ZXI9InVybCgjZ2xvdykiLz4KICAKICA8IS0tIFRvcCBidW1wIC0tPgogIDxyZWN0IHg9IjE3OCIgeT0iMTQ1IiB3aWR0aD0iOTgiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIyNDAiIHdpZHRoPSIxMTAiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIzMzUiIHdpZHRoPSI5OCIgaGVpZ2h0PSIzMiIgcng9IjYiIGZpbGw9InVybCgjZ29sZCkiLz4KICAKICA8IS0tIFRvcCBhcmMgLS0+CiAgPHBhdGggZD0iTSAyNzYgMTQ1IFEgMzQwIDE0NSAzNDAgMTk5IFEgMzQwIDI0MCAyNzYgMjQwIiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBCb3R0b20gYXJjIChzbGlnaHRseSB3aWRlcikgLS0+CiAgPHBhdGggZD0iTSAyODggMjQwIFEgMzU4IDI0MCAzNTggMjk1IFEgMzU4IDM2NyAyODggMzY3IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBUb3Agc2VyaWYgbGluZXMgKGNsYXNzaWMgQml0Y29pbiBzdHlsZSkgLS0+CiAgPHJlY3QgeD0iMjAyIiB5PSIxMjUiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KICA8cmVjdCB4PSIyNDgiIHk9IjEyNSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjI4IiByeD0iNCIgZmlsbD0idXJsKCNnb2xkKSIvPgogIDwhLS0gQm90dG9tIHNlcmlmIGxpbmVzIC0tPgogIDxyZWN0IHg9IjIwMiIgeT0iMzU5IiB3aWR0aD0iMjAiIGhlaWdodD0iMjgiIHJ4PSI0IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMjQ4IiB5PSIzNTkiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KCiAgPCEtLSBDb3JuZXIgZG90cyAvIGRlY29yYXRpdmUgLS0+CiAgPGNpcmNsZSBjeD0iMTI4IiBjeT0iMTI4IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgogIDxjaXJjbGUgY3g9IjM4NCIgY3k9IjEyOCIgcj0iNCIgZmlsbD0iI2Y1Yzg0MiIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KICA8Y2lyY2xlIGN4PSIxMjgiIGN5PSIzODQiIHI9IjQiIGZpbGw9IiNmNWM4NDIiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iMzg0IiBjeT0iMzg0IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgo8L3N2Zz4=">
<meta name="msapplication-TileImage" content="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYmciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMWExYTEwIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzBhMGEwOCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ29sZCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmN2Q3NzQiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmNWM4NDIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojYzg5NjBhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJyaW5nIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4zIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4wNSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9Imdsb3ciPgogICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI4IiByZXN1bHQ9ImJsdXIiLz4KICAgICAgPGZlTWVyZ2U+PGZlTWVyZ2VOb2RlIGluPSJibHVyIi8+PGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+PC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgPC9kZWZzPgogIAogIDwhLS0gQmFja2dyb3VuZCAtLT4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjExMCIgZmlsbD0idXJsKCNiZykiLz4KICAKICA8IS0tIE91dGVyIHJpbmcgZ2xvdyAtLT4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ1cmwoI3JpbmcpIiBzdHJva2Utd2lkdGg9IjEuNSIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTk1IiBmaWxsPSJub25lIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4yIi8+CiAgCiAgPCEtLSBTdWJ0bGUgZ3JpZCBsaW5lcyAtLT4KICA8bGluZSB4MT0iODAiIHkxPSIyNTYiIHgyPSI0MzIiIHkyPSIyNTYiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZS1vcGFjaXR5PSIwLjA4Ii8+CiAgPGxpbmUgeDE9IjI1NiIgeTE9IjgwIiB4Mj0iMjU2IiB5Mj0iNDMyIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4wOCIvPgoKICA8IS0tIElubmVyIGNpcmNsZSBiYWNrZ3JvdW5kIC0tPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTc1IiBmaWxsPSIjMTMxMzEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxNzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2Utb3BhY2l0eT0iMC4xNSIvPgoKICA8IS0tIEJpdGNvaW4gQiBzeW1ib2wgLSBib2xkLCBzaGFycCwgbW9kZXJuIC0tPgogIDwhLS0gTGVmdCB2ZXJ0aWNhbCBiYXIgLS0+CiAgPHJlY3QgeD0iMTc4IiB5PSIxNDUiIHdpZHRoPSIzMiIgaGVpZ2h0PSIyMjIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIiBmaWx0ZXI9InVybCgjZ2xvdykiLz4KICAKICA8IS0tIFRvcCBidW1wIC0tPgogIDxyZWN0IHg9IjE3OCIgeT0iMTQ1IiB3aWR0aD0iOTgiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIyNDAiIHdpZHRoPSIxMTAiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIzMzUiIHdpZHRoPSI5OCIgaGVpZ2h0PSIzMiIgcng9IjYiIGZpbGw9InVybCgjZ29sZCkiLz4KICAKICA8IS0tIFRvcCBhcmMgLS0+CiAgPHBhdGggZD0iTSAyNzYgMTQ1IFEgMzQwIDE0NSAzNDAgMTk5IFEgMzQwIDI0MCAyNzYgMjQwIiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBCb3R0b20gYXJjIChzbGlnaHRseSB3aWRlcikgLS0+CiAgPHBhdGggZD0iTSAyODggMjQwIFEgMzU4IDI0MCAzNTggMjk1IFEgMzU4IDM2NyAyODggMzY3IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBUb3Agc2VyaWYgbGluZXMgKGNsYXNzaWMgQml0Y29pbiBzdHlsZSkgLS0+CiAgPHJlY3QgeD0iMjAyIiB5PSIxMjUiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KICA8cmVjdCB4PSIyNDgiIHk9IjEyNSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjI4IiByeD0iNCIgZmlsbD0idXJsKCNnb2xkKSIvPgogIDwhLS0gQm90dG9tIHNlcmlmIGxpbmVzIC0tPgogIDxyZWN0IHg9IjIwMiIgeT0iMzU5IiB3aWR0aD0iMjAiIGhlaWdodD0iMjgiIHJ4PSI0IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMjQ4IiB5PSIzNTkiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KCiAgPCEtLSBDb3JuZXIgZG90cyAvIGRlY29yYXRpdmUgLS0+CiAgPGNpcmNsZSBjeD0iMTI4IiBjeT0iMTI4IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgogIDxjaXJjbGUgY3g9IjM4NCIgY3k9IjEyOCIgcj0iNCIgZmlsbD0iI2Y1Yzg0MiIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KICA8Y2lyY2xlIGN4PSIxMjgiIGN5PSIzODQiIHI9IjQiIGZpbGw9IiNmNWM4NDIiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iMzg0IiBjeT0iMzg0IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgo8L3N2Zz4=">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQUkgQXNzaXN0ZW50Iiwic2hvcnRfbmFtZSI6IkFJIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwYTBhMDgiLCJ0aGVtZV9jb2xvciI6IiNmNWM4NDIiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQTFNVElnTlRFeUlqNEtJQ0E4WkdWbWN6NEtJQ0FnSUR4c2FXNWxZWEpIY21Ga2FXVnVkQ0JwWkQwaVltY2lJSGd4UFNJd0pTSWdlVEU5SWpBbElpQjRNajBpTVRBd0pTSWdlVEk5SWpFd01DVWlQZ29nSUNBZ0lDQThjM1J2Y0NCdlptWnpaWFE5SWpBbElpQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pNV0V4WVRFd0lpOCtDaUFnSUNBZ0lEeHpkRzl3SUc5bVpuTmxkRDBpTVRBd0pTSWdjM1I1YkdVOUluTjBiM0F0WTI5c2IzSTZJekJoTUdFd09DSXZQZ29nSUNBZ1BDOXNhVzVsWVhKSGNtRmthV1Z1ZEQ0S0lDQWdJRHhzYVc1bFlYSkhjbUZrYVdWdWRDQnBaRDBpWjI5c1pDSWdlREU5SWpBbElpQjVNVDBpTUNVaUlIZ3lQU0l4TURBbElpQjVNajBpTVRBd0pTSStDaUFnSUNBZ0lEeHpkRzl3SUc5bVpuTmxkRDBpTUNVaUlITjBlV3hsUFNKemRHOXdMV052Ykc5eU9pTm1OMlEzTnpRaUx6NEtJQ0FnSUNBZ1BITjBiM0FnYjJabWMyVjBQU0kxTUNVaUlITjBlV3hsUFNKemRHOXdMV052Ykc5eU9pTm1OV000TkRJaUx6NEtJQ0FnSUNBZ1BITjBiM0FnYjJabWMyVjBQU0l4TURBbElpQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pZemc1TmpCaElpOCtDaUFnSUNBOEwyeHBibVZoY2tkeVlXUnBaVzUwUGdvZ0lDQWdQR3hwYm1WaGNrZHlZV1JwWlc1MElHbGtQU0p5YVc1bklpQjRNVDBpTUNVaUlIa3hQU0l3SlNJZ2VESTlJakV3TUNVaUlIa3lQU0l4TURBbElqNEtJQ0FnSUNBZ1BITjBiM0FnYjJabWMyVjBQU0l3SlNJZ2MzUjViR1U5SW5OMGIzQXRZMjlzYjNJNkkyWTFZemcwTWp0emRHOXdMVzl3WVdOcGRIazZNQzR6SWk4K0NpQWdJQ0FnSUR4emRHOXdJRzltWm5ObGREMGlNVEF3SlNJZ2MzUjViR1U5SW5OMGIzQXRZMjlzYjNJNkkyWTFZemcwTWp0emRHOXdMVzl3WVdOcGRIazZNQzR3TlNJdlBnb2dJQ0FnUEM5c2FXNWxZWEpIY21Ga2FXVnVkRDRLSUNBZ0lEeG1hV3gwWlhJZ2FXUTlJbWRzYjNjaVBnb2dJQ0FnSUNBOFptVkhZWFZ6YzJsaGJrSnNkWElnYzNSa1JHVjJhV0YwYVc5dVBTSTRJaUJ5WlhOMWJIUTlJbUpzZFhJaUx6NEtJQ0FnSUNBZ1BHWmxUV1Z5WjJVK1BHWmxUV1Z5WjJWT2IyUmxJR2x1UFNKaWJIVnlJaTgrUEdabFRXVnlaMlZPYjJSbElHbHVQU0pUYjNWeVkyVkhjbUZ3YUdsaklpOCtQQzltWlUxbGNtZGxQZ29nSUNBZ1BDOW1hV3gwWlhJK0NpQWdQQzlrWldaelBnb2dJQW9nSUR3aExTMGdRbUZqYTJkeWIzVnVaQ0F0TFQ0S0lDQThjbVZqZENCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlnY25nOUlqRXhNQ0lnWm1sc2JEMGlkWEpzS0NOaVp5a2lMejRLSUNBS0lDQThJUzB0SUU5MWRHVnlJSEpwYm1jZ1oyeHZkeUF0TFQ0S0lDQThZMmx5WTJ4bElHTjRQU0l5TlRZaUlHTjVQU0l5TlRZaUlISTlJakl4TUNJZ1ptbHNiRDBpYm05dVpTSWdjM1J5YjJ0bFBTSjFjbXdvSTNKcGJtY3BJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqRXVOU0l2UGdvZ0lEeGphWEpqYkdVZ1kzZzlJakkxTmlJZ1kzazlJakkxTmlJZ2NqMGlNVGsxSWlCbWFXeHNQU0p1YjI1bElpQnpkSEp2YTJVOUlpTm1OV000TkRJaUlITjBjbTlyWlMxM2FXUjBhRDBpTUM0MUlpQnpkSEp2YTJVdGIzQmhZMmwwZVQwaU1DNHlJaTgrQ2lBZ0NpQWdQQ0V0TFNCVGRXSjBiR1VnWjNKcFpDQnNhVzVsY3lBdExUNEtJQ0E4YkdsdVpTQjRNVDBpT0RBaUlIa3hQU0l5TlRZaUlIZ3lQU0kwTXpJaUlIa3lQU0l5TlRZaUlITjBjbTlyWlQwaUkyWTFZemcwTWlJZ2MzUnliMnRsTFhkcFpIUm9QU0l3TGpVaUlITjBjbTlyWlMxdmNHRmphWFI1UFNJd0xqQTRJaTgrQ2lBZ1BHeHBibVVnZURFOUlqSTFOaUlnZVRFOUlqZ3dJaUI0TWowaU1qVTJJaUI1TWowaU5ETXlJaUJ6ZEhKdmEyVTlJaU5tTldNNE5ESWlJSE4wY205clpTMTNhV1IwYUQwaU1DNDFJaUJ6ZEhKdmEyVXRiM0JoWTJsMGVUMGlNQzR3T0NJdlBnb0tJQ0E4SVMwdElFbHVibVZ5SUdOcGNtTnNaU0JpWVdOclozSnZkVzVrSUMwdFBnb2dJRHhqYVhKamJHVWdZM2c5SWpJMU5pSWdZM2s5SWpJMU5pSWdjajBpTVRjMUlpQm1hV3hzUFNJak1UTXhNekV3SWk4K0NpQWdQR05wY21Oc1pTQmplRDBpTWpVMklpQmplVDBpTWpVMklpQnlQU0l4TnpRaUlHWnBiR3c5SW01dmJtVWlJSE4wY205clpUMGlJMlkxWXpnME1pSWdjM1J5YjJ0bExYZHBaSFJvUFNJeElpQnpkSEp2YTJVdGIzQmhZMmwwZVQwaU1DNHhOU0l2UGdvS0lDQThJUzB0SUVKcGRHTnZhVzRnUWlCemVXMWliMndnTFNCaWIyeGtMQ0J6YUdGeWNDd2diVzlrWlhKdUlDMHRQZ29nSUR3aExTMGdUR1ZtZENCMlpYSjBhV05oYkNCaVlYSWdMUzArQ2lBZ1BISmxZM1FnZUQwaU1UYzRJaUI1UFNJeE5EVWlJSGRwWkhSb1BTSXpNaUlnYUdWcFoyaDBQU0l5TWpJaUlISjRQU0kySWlCbWFXeHNQU0oxY213b0kyZHZiR1FwSWlCbWFXeDBaWEk5SW5WeWJDZ2paMnh2ZHlraUx6NEtJQ0FLSUNBOElTMHRJRlJ2Y0NCaWRXMXdJQzB0UGdvZ0lEeHlaV04wSUhnOUlqRTNPQ0lnZVQwaU1UUTFJaUIzYVdSMGFEMGlPVGdpSUdobGFXZG9kRDBpTXpJaUlISjRQU0kySWlCbWFXeHNQU0oxY213b0kyZHZiR1FwSWk4K0NpQWdQSEpsWTNRZ2VEMGlNVGM0SWlCNVBTSXlOREFpSUhkcFpIUm9QU0l4TVRBaUlHaGxhV2RvZEQwaU16SWlJSEo0UFNJMklpQm1hV3hzUFNKMWNtd29JMmR2YkdRcElpOCtDaUFnUEhKbFkzUWdlRDBpTVRjNElpQjVQU0l6TXpVaUlIZHBaSFJvUFNJNU9DSWdhR1ZwWjJoMFBTSXpNaUlnY25nOUlqWWlJR1pwYkd3OUluVnliQ2dqWjI5c1pDa2lMejRLSUNBS0lDQThJUzB0SUZSdmNDQmhjbU1nTFMwK0NpQWdQSEJoZEdnZ1pEMGlUU0F5TnpZZ01UUTFJRkVnTXpRd0lERTBOU0F6TkRBZ01UazVJRkVnTXpRd0lESTBNQ0F5TnpZZ01qUXdJaUJtYVd4c1BTSnViMjVsSWlCemRISnZhMlU5SW5WeWJDZ2paMjlzWkNraUlITjBjbTlyWlMxM2FXUjBhRDBpTXpJaUlITjBjbTlyWlMxc2FXNWxZMkZ3UFNKeWIzVnVaQ0lnWm1sc2RHVnlQU0oxY213b0kyZHNiM2NwSWk4K0NpQWdDaUFnUENFdExTQkNiM1IwYjIwZ1lYSmpJQ2h6YkdsbmFIUnNlU0IzYVdSbGNpa2dMUzArQ2lBZ1BIQmhkR2dnWkQwaVRTQXlPRGdnTWpRd0lGRWdNelU0SURJME1DQXpOVGdnTWprMUlGRWdNelU0SURNMk55QXlPRGdnTXpZM0lpQm1hV3hzUFNKdWIyNWxJaUJ6ZEhKdmEyVTlJblZ5YkNnaloyOXNaQ2tpSUhOMGNtOXJaUzEzYVdSMGFEMGlNeklpSUhOMGNtOXJaUzFzYVc1bFkyRndQU0p5YjNWdVpDSWdabWxzZEdWeVBTSjFjbXdvSTJkc2IzY3BJaTgrQ2lBZ0NpQWdQQ0V0TFNCVWIzQWdjMlZ5YVdZZ2JHbHVaWE1nS0dOc1lYTnphV01nUW1sMFkyOXBiaUJ6ZEhsc1pTa2dMUzArQ2lBZ1BISmxZM1FnZUQwaU1qQXlJaUI1UFNJeE1qVWlJSGRwWkhSb1BTSXlNQ0lnYUdWcFoyaDBQU0l5T0NJZ2NuZzlJalFpSUdacGJHdzlJblZ5YkNnaloyOXNaQ2tpTHo0S0lDQThjbVZqZENCNFBTSXlORGdpSUhrOUlqRXlOU0lnZDJsa2RHZzlJakl3SWlCb1pXbG5hSFE5SWpJNElpQnllRDBpTkNJZ1ptbHNiRDBpZFhKc0tDTm5iMnhrS1NJdlBnb2dJRHdoTFMwZ1FtOTBkRzl0SUhObGNtbG1JR3hwYm1WeklDMHRQZ29nSUR4eVpXTjBJSGc5SWpJd01pSWdlVDBpTXpVNUlpQjNhV1IwYUQwaU1qQWlJR2hsYVdkb2REMGlNamdpSUhKNFBTSTBJaUJtYVd4c1BTSjFjbXdvSTJkdmJHUXBJaTgrQ2lBZ1BISmxZM1FnZUQwaU1qUTRJaUI1UFNJek5Ua2lJSGRwWkhSb1BTSXlNQ0lnYUdWcFoyaDBQU0l5T0NJZ2NuZzlJalFpSUdacGJHdzlJblZ5YkNnaloyOXNaQ2tpTHo0S0NpQWdQQ0V0TFNCRGIzSnVaWElnWkc5MGN5QXZJR1JsWTI5eVlYUnBkbVVnTFMwK0NpQWdQR05wY21Oc1pTQmplRDBpTVRJNElpQmplVDBpTVRJNElpQnlQU0kwSWlCbWFXeHNQU0lqWmpWak9EUXlJaUJtYVd4c0xXOXdZV05wZEhrOUlqQXVNeUl2UGdvZ0lEeGphWEpqYkdVZ1kzZzlJak00TkNJZ1kzazlJakV5T0NJZ2NqMGlOQ0lnWm1sc2JEMGlJMlkxWXpnME1pSWdabWxzYkMxdmNHRmphWFI1UFNJd0xqTWlMejRLSUNBOFkybHlZMnhsSUdONFBTSXhNamdpSUdONVBTSXpPRFFpSUhJOUlqUWlJR1pwYkd3OUlpTm1OV000TkRJaUlHWnBiR3d0YjNCaFkybDBlVDBpTUM0eklpOCtDaUFnUEdOcGNtTnNaU0JqZUQwaU16ZzBJaUJqZVQwaU16ZzBJaUJ5UFNJMElpQm1hV3hzUFNJalpqVmpPRFF5SWlCbWFXeHNMVzl3WVdOcGRIazlJakF1TXlJdlBnbzhMM04yWno0PSIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIiwicHVycG9zZSI6ImFueSBtYXNrYWJsZSJ9XX0=">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;800&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a08; --surface: #131310; --surface2: #1c1c18; --border: #2a2a24;
    --accent: #f5c842; --accent2: #e8a020; --red: #e85050; --green: #4caf50;
    --text: #e8e8d8; --muted: #7a7a68; --radius: 2px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Mono', monospace; min-height: 100vh; display: flex; flex-direction: column; overscroll-behavior: none; }

  header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; border-bottom: 1px solid var(--border); background: var(--surface); position: sticky; top: 0; z-index: 100; }
  .logo { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.05rem; letter-spacing: 0.05em; color: var(--accent); }
  .logo span { color: var(--text); font-weight: 400; }
  .header-right { display: flex; align-items: center; gap: 12px; }
  .install-btn { background: var(--accent); color: #000; border: none; padding: 6px 12px; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.7rem; cursor: pointer; border-radius: var(--radius); display: none; }
  .install-btn.visible { display: block; }
  .status-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1}50%{opacity:.4} }

  .tabs { display: flex; border-bottom: 1px solid var(--border); background: var(--surface); overflow-x: auto; }
  .tab { padding: 13px 18px; font-family: 'Syne', sans-serif; font-size: 0.75rem; font-weight: 600; letter-spacing: 0.07em; text-transform: uppercase; cursor: pointer; color: var(--muted); border-bottom: 2px solid transparent; transition: all 0.2s; background: none; border-top: none; border-left: none; border-right: none; white-space: nowrap; flex-shrink: 0; }
  .tab:hover { color: var(--text); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  .panel { display: none; flex: 1; flex-direction: column; overflow: hidden; height: calc(100vh - 148px); }
  .panel.active { display: flex; }

  /* CHAT */
  .chat-layout { display: flex; flex: 1; overflow: hidden; }
  .sidebar { width: 195px; border-right: 1px solid var(--border); background: var(--surface); padding: 14px 11px; display: flex; flex-direction: column; gap: 5px; flex-shrink: 0; overflow-y: auto; }
  .sidebar-label { font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin: 10px 0 4px; font-family: 'Syne', sans-serif; }
  .sidebar-label:first-child { margin-top: 0; }
  .quick-btn { background: var(--surface2); border: 1px solid var(--border); color: var(--text); padding: 8px 10px; font-family: 'IBM Plex Mono', monospace; font-size: 0.67rem; cursor: pointer; text-align: left; border-radius: var(--radius); transition: all 0.15s; line-height: 1.4; }
  .quick-btn:hover { border-color: var(--accent); color: var(--accent); background: rgba(245,200,66,.05); }
  .chat-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
  .messages { flex: 1; overflow-y: auto; padding: 18px; display: flex; flex-direction: column; gap: 13px; scroll-behavior: smooth; }
  .messages::-webkit-scrollbar { width: 3px; }
  .messages::-webkit-scrollbar-thumb { background: var(--border); }
  .msg { display: flex; gap: 11px; animation: fadeIn 0.25s ease; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
  .msg.user { flex-direction: row-reverse; }
  .msg-avatar { width: 28px; height: 28px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-size: 0.68rem; font-weight: 700; flex-shrink: 0; font-family: 'Syne', sans-serif; }
  .msg.ai .msg-avatar { background: var(--accent); color: #000; }
  .msg.user .msg-avatar { background: var(--surface2); border: 1px solid var(--border); color: var(--muted); }
  .msg-bubble { max-width: 75%; padding: 10px 13px; border-radius: var(--radius); font-size: 0.79rem; line-height: 1.7; border: 1px solid var(--border); }
  .msg.ai .msg-bubble { background: #161612; border-left: 2px solid var(--accent); }
  .msg.user .msg-bubble { background: #1e1e16; text-align: right; }
  .input-area { padding: 13px 16px; border-top: 1px solid var(--border); background: var(--surface); display: flex; gap: 8px; align-items: flex-end; }
  textarea { width: 100%; background: var(--surface2); border: 1px solid var(--border); color: var(--text); font-family: 'IBM Plex Mono', monospace; font-size: 0.79rem; padding: 9px 11px; border-radius: var(--radius); resize: none; min-height: 40px; max-height: 110px; outline: none; transition: border-color 0.15s; line-height: 1.5; }
  textarea:focus { border-color: var(--accent); }
  textarea::placeholder { color: var(--muted); }
  .send-btn { background: var(--accent); color: #000; border: none; padding: 9px 15px; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.77rem; cursor: pointer; border-radius: var(--radius); transition: all 0.15s; height: 40px; white-space: nowrap; }
  .send-btn:hover { background: var(--accent2); }
  .send-btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .thinking { display: flex; gap: 5px; padding: 4px 0; align-items: center; }
  .thinking span { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; animation: bounce 1.2s infinite; }
  .thinking span:nth-child(2){animation-delay:.2s} .thinking span:nth-child(3){animation-delay:.4s}
  @keyframes bounce{0%,80%,100%{transform:scale(.6);opacity:.4}40%{transform:scale(1);opacity:1}}
  .welcome-msg { color: var(--muted); font-size: 0.75rem; line-height: 1.7; text-align: center; padding: 28px 14px; }
  .welcome-msg h2 { font-family: 'Syne', sans-serif; font-size: 0.98rem; color: var(--accent); margin-bottom: 7px; font-weight: 800; }

  /* BTC PANEL */
  .btc-scroll { flex: 1; overflow-y: auto; padding: 18px; display: flex; flex-direction: column; gap: 15px; }
  .section-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.7rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--accent); margin-bottom: 9px; }

  .ticker { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 15px 18px; display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
  .ticker-item label { font-size: 0.58rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); display: block; margin-bottom: 3px; font-family: 'Syne', sans-serif; }
  .ticker-item .val { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.05rem; color: var(--text); }
  .ticker-item .val.up { color: var(--green); }
  .ticker-item .val.down { color: var(--red); }
  .ticker-item .val.accent { color: var(--accent); }
  .refresh-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
  .refresh-btn { background: transparent; border: 1px solid var(--border); color: var(--muted); padding: 4px 9px; font-family: 'IBM Plex Mono', monospace; font-size: 0.63rem; cursor: pointer; border-radius: var(--radius); transition: all 0.15s; }
  .refresh-btn:hover { border-color: var(--accent); color: var(--accent); }

  .params-grid { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 15px 18px; display: flex; flex-direction: column; gap: 11px; }
  .param-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .param-group { display: flex; flex-direction: column; gap: 4px; }
  .param-group label { font-size: 0.6rem; letter-spacing: 0.09em; text-transform: uppercase; color: var(--muted); font-family: 'Syne', sans-serif; }
  .param-group input, .param-group select { background: var(--surface2); border: 1px solid var(--border); color: var(--text); font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; padding: 7px 9px; border-radius: var(--radius); outline: none; width: 100%; }
  .param-group input:focus, .param-group select:focus { border-color: var(--accent); }
  .param-group select option { background: var(--surface2); }
  .toggles { display: flex; flex-wrap: wrap; gap: 13px; margin-top: 2px; }
  .toggle-row { display: flex; align-items: center; gap: 7px; }
  .toggle-row label { font-size: 0.63rem; color: var(--muted); cursor: pointer; }
  input[type=checkbox] { accent-color: var(--accent); width: 13px; height: 13px; cursor: pointer; }

  .notif-box { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 15px 18px; }
  .notif-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
  .notif-time { background: var(--surface2); border: 1px solid var(--border); color: var(--text); font-family: 'IBM Plex Mono', monospace; font-size: 0.79rem; padding: 7px 9px; border-radius: var(--radius); outline: none; }
  .notif-time:focus { border-color: var(--accent); }
  .notif-enable-btn { background: var(--surface2); border: 1px solid var(--border); color: var(--text); padding: 7px 13px; font-family: 'Syne', sans-serif; font-weight: 600; font-size: 0.7rem; cursor: pointer; border-radius: var(--radius); transition: all 0.15s; white-space: nowrap; }
  .notif-enable-btn:hover { border-color: var(--accent); color: var(--accent); }
  .notif-enable-btn.enabled { background: var(--accent); color: #000; border-color: var(--accent); }
  .notif-status { font-size: 0.66rem; color: var(--muted); flex: 1; }

  .analyze-btn { background: var(--accent); color: #000; border: none; padding: 13px 20px; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.84rem; cursor: pointer; border-radius: var(--radius); transition: all 0.15s; width: 100%; letter-spacing: 0.04em; }
  .analyze-btn:hover { background: var(--accent2); }
  .analyze-btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .btc-result { background: #161612; border: 1px solid var(--border); border-left: 2px solid var(--accent); border-radius: var(--radius); padding: 16px 18px; font-size: 0.79rem; line-height: 1.8; white-space: pre-wrap; min-height: 80px; color: var(--text); }
  .result-placeholder { color: var(--muted); font-style: italic; }

  /* SETTINGS */
  .settings-scroll { flex: 1; overflow-y: auto; padding: 18px; display: flex; flex-direction: column; gap: 15px; }
  .settings-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px 18px; }
  .settings-card h3 { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.7rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--accent); margin-bottom: 13px; }
  .setting-row { display: flex; flex-direction: column; gap: 4px; margin-bottom: 11px; }
  .setting-row:last-child { margin-bottom: 0; }
  .setting-row label { font-size: 0.6rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); font-family: 'Syne', sans-serif; }
  .setting-row input, .setting-row textarea { background: var(--surface2); border: 1px solid var(--border); color: var(--text); font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; padding: 7px 9px; border-radius: var(--radius); outline: none; width: 100%; }
  .setting-row input:focus, .setting-row textarea:focus { border-color: var(--accent); }
  .setting-row textarea { min-height: 65px; resize: vertical; }
  .save-settings-btn { background: var(--accent); color: #000; border: none; padding: 10px 20px; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.77rem; cursor: pointer; border-radius: var(--radius); width: 100%; }

  /* API bar */
  .api-bar { padding: 7px 16px; border-top: 1px solid var(--border); background: var(--bg); display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
  .api-bar label { font-size: 0.6rem; color: var(--muted); white-space: nowrap; }
  .api-key-input { flex: 1; background: var(--surface2); border: 1px solid var(--border); color: var(--text); font-family: 'IBM Plex Mono', monospace; font-size: 0.69rem; padding: 6px 8px; border-radius: var(--radius); outline: none; min-width: 0; }
  .api-key-input:focus { border-color: var(--accent); }
  .save-key-btn { background: transparent; border: 1px solid var(--border); color: var(--muted); padding: 5px 9px; font-family: 'IBM Plex Mono', monospace; font-size: 0.63rem; cursor: pointer; border-radius: var(--radius); transition: all 0.15s; white-space: nowrap; }
  .save-key-btn:hover { border-color: var(--accent); color: var(--accent); }

  @media (max-width: 600px) {
    .sidebar { display: none; }
    .param-row { grid-template-columns: 1fr; }
    .ticker { grid-template-columns: 1fr 1fr; }
    .ticker-item .val { font-size: 0.9rem; }
  }

  /* ‚ïê‚ïê‚ïê BYGGKALKYL STYLES ‚ïê‚ïê‚ïê */
  #panel-bygg { overflow: hidden; display: flex; flex-direction: column; } #panel-bygg > div { display: flex; flex-direction: column; flex: 1; overflow: hidden; } #panel-bygg nav { flex-shrink: 0; position: relative !important; } #panel-bygg .page { flex: 1; overflow-y: auto; }

#panel-bygg :root{
    --bg: #0f0f0e; --surface: #1a1a18; --surface2: #242422; --border: #2e2e2b;
    --accent: #d4a853; --accent2: #b8893a; --text: #e8e6e0; --muted: #7a7870;
    --rot: #4a9ebb;
  }

#panel-bygg *{ box-sizing: border-box; margin: 0; padding: 0; }

#panel-bygg body{ background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; font-weight: 400; min-height: 100vh; font-size: 15px; }

#panel-bygg /* AUTH SCREEN */
  #auth-screen{ display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 32px 20px; }

#panel-bygg .auth-logo{ font-family: 'DM Serif Display', serif; font-size: 36px; color: var(--accent); margin-bottom: 8px; }

#panel-bygg .auth-sub{ font-size: 14px; color: var(--muted); margin-bottom: 40px; }

#panel-bygg .auth-card{ background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 28px 24px; width: 100%; max-width: 380px; }

#panel-bygg .auth-tabs{ display: flex; gap: 0; margin-bottom: 24px; background: var(--surface2); border-radius: 8px; padding: 3px; }

#panel-bygg .auth-tab{ flex: 1; text-align: center; padding: 8px; font-size: 14px; font-weight: 500; color: var(--muted); cursor: pointer; border-radius: 6px; transition: all 0.2s; }

#panel-bygg .auth-tab.active{ background: var(--accent); color: #0f0f0e; }

#panel-bygg .auth-error{ background: #2a1010; border: 1px solid #5a2020; border-radius: 8px; padding: 10px 14px; font-size: 13px; color: #e07070; margin-top: 12px; display: none; }

#panel-bygg .auth-info{ background: #1a2a1a; border: 1px solid #2a4a2a; border-radius: 8px; padding: 10px 14px; font-size: 13px; color: #70c070; margin-top: 12px; display: none; }

#panel-bygg /* APP */
  #app-screen{ display: none; }

#panel-bygg nav{ background: var(--surface); border-bottom: 1px solid var(--border); padding: 0 12px; display: flex; align-items: center; position: sticky; top: 0; z-index: 100; }

#panel-bygg .nav-logo{ font-family: 'DM Serif Display', serif; font-size: 17px; color: var(--accent); padding: 14px 0; flex: 1; }

#panel-bygg .nav-tabs{ display: flex; }

#panel-bygg .nav-tab{ padding: 14px 10px; font-size: 12px; font-weight: 500; color: var(--muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; white-space: nowrap; }

#panel-bygg .nav-tab.active{ color: var(--accent); border-bottom-color: var(--accent); }

#panel-bygg .nav-user{ font-size: 11px; color: var(--muted); cursor: pointer; padding: 6px 8px; border-radius: 6px; }

#panel-bygg .nav-user:hover{ color: #e07070; }

#panel-bygg .page{ display: none; padding: 20px 16px 100px; max-width: 600px; margin: 0 auto; }

#panel-bygg .page.active{ display: block; }

#panel-bygg .card{ background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 16px; }

#panel-bygg .card-title{ font-family: 'DM Serif Display', serif; font-size: 16px; color: var(--accent); margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }

#panel-bygg .card-title::before{ content: ''; display: inline-block; width: 3px; height: 18px; background: var(--accent); border-radius: 2px; }

#panel-bygg label{ display: block; font-size: 12px; font-weight: 500; color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 6px; margin-top: 14px; }

#panel-bygg label:first-child{ margin-top: 0; }

#panel-bygg input, #panel-bygg textarea, #panel-bygg select{ width: 100%; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: 'Outfit', sans-serif; font-size: 15px; padding: 10px 14px; transition: border-color 0.2s; outline: none; -webkit-appearance: none; }

#panel-bygg input:focus, #panel-bygg textarea:focus, #panel-bygg select:focus{ border-color: var(--accent); }

#panel-bygg textarea{ resize: vertical; min-height: 90px; }

#panel-bygg .row2{ display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

#panel-bygg .btn{ display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 11px 18px; border-radius: 8px; font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; border: none; transition: all 0.2s; }

#panel-bygg .btn-primary{ background: var(--accent); color: #0f0f0e; width: 100%; padding: 14px; font-size: 15px; margin-top: 4px; }

#panel-bygg .btn-primary:hover{ background: var(--accent2); }

#panel-bygg .btn-ghost{ background: transparent; border: 1px solid var(--border); color: var(--text); font-size: 13px; padding: 8px 14px; }

#panel-bygg .btn-ghost:hover{ border-color: var(--accent); color: var(--accent); }

#panel-bygg .btn-danger{ background: transparent; border: 1px solid #3a1e1e; color: #e07070; font-size: 13px; padding: 8px 10px; }

#panel-bygg .btn-danger:hover{ background: #2a1010; }

#panel-bygg .btn-add{ background: transparent; border: 1px dashed var(--border); color: var(--muted); width: 100%; padding: 10px; font-size: 13px; margin-top: 8px; }

#panel-bygg .btn-add:hover{ border-color: var(--accent); color: var(--accent); }

#panel-bygg .btn-sm{ padding: 6px 12px; font-size: 12px; }

#panel-bygg .btn:disabled{ opacity: 0.5; cursor: not-allowed; }

#panel-bygg .arbetsteg-row{ display: flex; align-items: flex-start; gap: 8px; padding: 8px 0; border-bottom: 1px solid var(--border); }

#panel-bygg .arbetsteg-row:last-child{ border-bottom: none; }

#panel-bygg .step-num{ width: 24px; height: 24px; background: var(--surface2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; color: var(--muted); flex-shrink: 0; margin-top: 10px; font-family: 'DM Mono', monospace; }

#panel-bygg .arbetsteg-row input{ flex: 1; }

#panel-bygg .mat-row{ display: flex; align-items: center; gap: 8px; padding: 8px 0; border-bottom: 1px solid var(--border); }

#panel-bygg .mat-row:last-child{ border-bottom: none; }

#panel-bygg .mat-row .mat-name{ flex: 1; min-width: 0; }

#panel-bygg .mat-row .mat-qty{ width: 65px; flex: none; }

#panel-bygg .mat-row .mat-unit{ width: 40px; flex: none; font-size: 12px; color: var(--muted); padding: 0; background: transparent; border: none; text-align: center; }

#panel-bygg .mat-row .mat-price{ width: 80px; flex: none; font-family: 'DM Mono', monospace; font-size: 12px; color: var(--muted); padding: 0; background: transparent; border: none; text-align: right; }

#panel-bygg .db-row{ display: flex; align-items: center; gap: 8px; padding: 10px 0; border-bottom: 1px solid var(--border); }

#panel-bygg .db-row:last-child{ border-bottom: none; }

#panel-bygg .summary-box{ background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 16px; margin-top: 16px; }

#panel-bygg .sum-row{ display: flex; justify-content: space-between; align-items: center; padding: 6px 0; font-size: 14px; color: var(--muted); border-bottom: 1px solid var(--border); }

#panel-bygg .sum-row:last-child{ border-bottom: none; }

#panel-bygg .sum-row.big{ color: var(--text); font-weight: 600; font-size: 16px; padding-top: 10px; margin-top: 4px; }

#panel-bygg .sum-row.rot-row{ color: var(--rot); }

#panel-bygg .sum-row.final-row{ color: var(--accent); font-family: 'DM Serif Display', serif; font-size: 20px; padding-top: 12px; }

#panel-bygg .sum-val{ font-family: 'DM Mono', monospace; font-size: 14px; }

#panel-bygg .sum-row.big .sum-val{ font-size: 16px; }

#panel-bygg .sum-row.final-row .sum-val{ font-size: 20px; }

#panel-bygg .toggle{ position: relative; width: 44px; height: 24px; flex-shrink: 0; }

#panel-bygg .toggle input{ opacity: 0; width: 0; height: 0; }

#panel-bygg .toggle-slider{ position: absolute; inset: 0; background: var(--border); border-radius: 24px; cursor: pointer; transition: 0.2s; }

#panel-bygg .toggle-slider::before{ content: ''; position: absolute; width: 18px; height: 18px; left: 3px; top: 3px; background: white; border-radius: 50%; transition: 0.2s; }

#panel-bygg .toggle input:checked + .toggle-slider{ background: var(--accent); }

#panel-bygg .toggle input:checked + .toggle-slider::before{ transform: translateX(20px); }

#panel-bygg .setting-row{ display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); gap: 12px; }

#panel-bygg .setting-row:last-child{ border-bottom: none; }

#panel-bygg .setting-row input{ width: 130px; text-align: right; flex-shrink: 0; }

#panel-bygg .setting-label{ font-size: 14px; }

#panel-bygg .setting-sub{ font-size: 12px; color: var(--muted); }

#panel-bygg .badge{ display: inline-block; padding: 2px 8px; border-radius: 20px; font-size: 11px; font-weight: 600; }

#panel-bygg .badge-rot{ background: #1a3340; color: var(--rot); }

#panel-bygg .page-header{ margin-bottom: 20px; }

#panel-bygg .page-header h1{ font-family: 'DM Serif Display', serif; font-size: 26px; color: var(--accent); margin-bottom: 4px; }

#panel-bygg .page-header p{ font-size: 13px; color: var(--muted); }

#panel-bygg .search-wrap{ position: relative; }

#panel-bygg .search-dropdown{ position: absolute; top: 100%; left: 0; right: 0; background: var(--surface); border: 1px solid var(--accent); border-radius: 8px; z-index: 200; max-height: 220px; overflow-y: auto; margin-top: 2px; box-shadow: 0 8px 24px rgba(0,0,0,0.4); }

#panel-bygg .search-item{ padding: 10px 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-size: 14px; border-bottom: 1px solid var(--border); }

#panel-bygg .search-item:last-child{ border-bottom: none; }

#panel-bygg .search-item:hover{ background: var(--surface2); }

#panel-bygg .si-meta{ font-size: 12px; color: var(--muted); font-family: 'DM Mono', monospace; }

#panel-bygg .logo-upload-area{ border: 2px dashed var(--border); border-radius: 10px; padding: 20px; text-align: center; cursor: pointer; transition: border-color 0.2s; }

#panel-bygg .logo-upload-area:hover{ border-color: var(--accent); }

#panel-bygg .logo-preview-img{ max-height: 70px; max-width: 200px; margin: 0 auto; display: block; }

#panel-bygg .logo-hint{ font-size: 12px; color: var(--muted); margin-top: 8px; }

#panel-bygg /* OFFERTER LISTA */
  .offert-list-row{ display: flex; align-items: center; gap: 10px; padding: 12px 0; border-bottom: 1px solid var(--border); cursor: pointer; }

#panel-bygg .offert-list-row:last-child{ border-bottom: none; }

#panel-bygg .offert-list-row:hover .offert-list-nr{ color: var(--accent); }

#panel-bygg .offert-list-nr{ font-family: 'DM Mono', monospace; font-size: 13px; color: var(--accent); width: 80px; flex-shrink: 0; }

#panel-bygg .offert-list-kund{ flex: 1; font-size: 14px; }

#panel-bygg .offert-list-datum{ font-size: 12px; color: var(--muted); }

#panel-bygg /* OFFER PREVIEW */
  .offer-preview{ background: #fff; color: #1a1a18; border-radius: 12px; padding: 28px 24px; margin-top: 16px; font-family: 'Outfit', sans-serif; }

#panel-bygg .offer-header{ display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; padding-bottom: 20px; border-bottom: 2px solid #d4a853; }

#panel-bygg .offer-company{ font-family: 'DM Serif Display', serif; font-size: 20px; color: #1a1a18; }

#panel-bygg .offer-company-sub{ font-size: 12px; color: #666; margin-top: 2px; }

#panel-bygg .offer-nr{ text-align: right; font-size: 12px; color: #666; }

#panel-bygg .offer-nr strong{ font-size: 16px; color: #1a1a18; display: block; font-family: 'DM Mono', monospace; }

#panel-bygg .offer-section{ margin-bottom: 20px; }

#panel-bygg .offer-section h3{ font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: #999; margin-bottom: 8px; }

#panel-bygg .offer-steps{ list-style: none; }

#panel-bygg .offer-steps li{ padding: 6px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; display: flex; align-items: center; gap: 8px; }

#panel-bygg .offer-steps li::before{ content: '‚Äì'; color: #d4a853; font-weight: bold; }

#panel-bygg .offer-materials{ font-size: 13px; color: #444; }

#panel-bygg .offer-price-table{ width: 100%; border-collapse: collapse; }

#panel-bygg .offer-price-table td{ padding: 7px 0; font-size: 14px; border-bottom: 1px solid #f0f0f0; }

#panel-bygg .offer-price-table tr:last-child td{ border-bottom: none; }

#panel-bygg .offer-price-table .label{ color: #444; }

#panel-bygg .offer-price-table .val{ text-align: right; font-family: 'DM Mono', monospace; font-weight: 500; }

#panel-bygg .offer-total-row td{ font-weight: 700; font-size: 16px; border-top: 2px solid #d4a853 !important; padding-top: 12px !important; }

#panel-bygg .offer-rot-note{ background: #e8f4fb; border-radius: 6px; padding: 10px 14px; font-size: 13px; color: #2980b9; margin-top: 8px; }

#panel-bygg .offer-footer{ border-top: 1px solid #eee; padding-top: 16px; font-size: 12px; color: #888; line-height: 1.7; }

#panel-bygg .offer-conditions{ background: #fafafa; border-radius: 6px; padding: 12px; font-size: 12px; color: #666; line-height: 1.6; }

#panel-bygg .offer-validity{ font-weight: 600; color: #1a1a18; font-size: 13px; margin-top: 10px; }

#panel-bygg .cat-head{ font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--accent); padding: 12px 0 6px; }

#panel-bygg /* TOAST */
  .toast{ position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 12px 20px; font-size: 14px; z-index: 999; box-shadow: 0 8px 24px rgba(0,0,0,0.4); display: none; white-space: nowrap; }

#panel-bygg .toast.success{ border-color: #2a4a2a; color: #70c070; }

#panel-bygg .toast.error{ border-color: #5a2020; color: #e07070; }

#panel-bygg /* SPINNER */
  .spinner{ display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-top-color: currentColor; border-radius: 50%; animation: spin 0.7s linear infinite; }

@keyframes spin{ to { transform: rotate(360deg); } }

#panel-bygg #mat-col-header{ display: none; }

@media print{
    body { background: white; }
    nav, .page-header, .card:not(.offer-card), .btn { display: none !important; }
    .page { padding: 0; }
    .offer-preview { border-radius: 0; padding: 20px; }
  }


</style>
</head>
<body>

<header>
  <div class="logo">AI<span>Assistent</span></div>
  <div class="header-right">
    <button class="install-btn" id="installBtn" onclick="installApp()">‚¨á Installera</button>
    <div class="status-dot"></div>
  </div>
</header>

<div class="tabs">
  <button class="tab active" onclick="switchTab('chat')">üí¨ Chat</button>
  <button class="tab" onclick="switchTab('btc')">‚Çø BTC-Analys</button>
  <button class="tab" onclick="switchTab('bygg')">üèóÔ∏è Byggkalkyl</button>
  <button class="tab" onclick="switchTab('settings')">‚öô Inst√§llningar</button>
</div>

<!-- CHAT -->
<div class="panel active" id="panel-chat">
  <div class="chat-layout">
    <div class="sidebar">
      <div class="sidebar-label">Snabbval</div>
      <button class="quick-btn" onclick="quickSend('Ge mig en daglig aff√§rs√∂versikt f√∂r mina tre verksamheter.')">üìä Daglig √∂versikt</button>
      <button class="quick-btn" onclick="quickSend('Vad b√∂r jag t√§nka p√• n√§r jag hanterar hyresg√§ster och avtal?')">üè† Uthyrning</button>
      <button class="quick-btn" onclick="quickSend('Ge mig tips f√∂r att effektivisera mitt byggf√∂retag.')">üèóÔ∏è Byggf√∂retag</button>
      <button class="quick-btn" onclick="quickSend('Hur ska jag t√§nka kring daglig Bitcoin-handel och riskhantering?')">‚Çø Bitcoin-tips</button>
      <div class="sidebar-label">Verktyg</div>
      <button class="quick-btn" onclick="clearChat()">üóëÔ∏è Rensa chat</button>
    </div>
    <div class="chat-area">
      <div class="messages" id="messages">
        <div class="welcome-msg">
          <h2>Hej! Jag √§r din AI-assistent.</h2>
          Jag k√§nner till ditt byggf√∂retag, dina hyresbost√§der och din Bitcoin-handel. St√§ll en fr√•ga eller v√§lj ett snabbval.
        </div>
      </div>
      <div id="img-preview-bar" style="display:none;padding:8px 16px 0;background:var(--surface);border-top:1px solid var(--border);">
        <div style="display:flex;align-items:center;gap:8px;">
          <img id="img-preview-thumb" style="height:48px;border-radius:2px;border:1px solid var(--border);">
          <span style="font-size:0.7rem;color:var(--muted)" id="img-preview-name"></span>
          <button onclick="clearImage()" style="background:transparent;border:none;color:var(--muted);cursor:pointer;font-size:1rem;margin-left:auto;">‚úï</button>
        </div>
      </div>
      <div class="input-area">
        <button onclick="document.getElementById('imgUpload').click()" title="Bifoga bild/graf" style="background:var(--surface2);border:1px solid var(--border);color:var(--muted);width:40px;height:40px;border-radius:var(--radius);cursor:pointer;font-size:1.1rem;flex-shrink:0;transition:all 0.15s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">üìé</button>
        <input type="file" id="imgUpload" accept="image/*" style="display:none" onchange="handleImageUpload(this)">
        <textarea id="userInput" placeholder="Skriv din fr√•ga h√§r... eller bifoga en graf med üìé" rows="1" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">Skicka ‚Üí</button>
      </div>
    </div>
  </div>
</div>

<!-- BTC ANALYS -->
<div class="panel" id="panel-btc">
  <div class="btc-scroll">

    <div>
      <div class="refresh-row">
        <div class="section-title" style="margin:0">Live Bitcoin-data</div>
        <div style="display:flex;gap:8px;align-items:center">
          <span id="lastUpdate" style="font-size:.63rem;color:var(--muted)">H√§mtar...</span>
          <button class="refresh-btn" onclick="fetchBTCData()">‚Üª</button>
        </div>
      </div>
      <div class="ticker">
        <div class="ticker-item"><label>Pris (USD)</label><div class="val accent" id="t-price">‚Äî</div></div>
        <div class="ticker-item"><label>24h f√∂r√§ndring</label><div class="val" id="t-change">‚Äî</div></div>
        <div class="ticker-item"><label>24h Volym</label><div class="val" id="t-vol">‚Äî</div></div>
        <div class="ticker-item"><label>Marketcap</label><div class="val" id="t-mcap">‚Äî</div></div>
        <div class="ticker-item"><label>24h H√∂g</label><div class="val up" id="t-high">‚Äî</div></div>
        <div class="ticker-item"><label>24h L√•g</label><div class="val down" id="t-low">‚Äî</div></div>
      </div>
    </div>

    <div>
      <div class="refresh-row" style="margin-bottom:7px">
        <div class="section-title" style="margin:0">Tekniska indikatorer</div>
        <button class="refresh-btn" onclick="fetchIndicators()" id="indBtn">‚Üª H√§mta</button>
      </div>
      <div class="ticker" id="indicators-grid">
        <div class="ticker-item"><label>EMA 20</label><div class="val" id="i-ema20">‚Äî</div></div>
        <div class="ticker-item"><label>EMA 50</label><div class="val" id="i-ema50">‚Äî</div></div>
        <div class="ticker-item"><label>EMA 200</label><div class="val" id="i-ema200">‚Äî</div></div>
        <div class="ticker-item"><label>MACD</label><div class="val" id="i-macd">‚Äî</div></div>
        <div class="ticker-item"><label>MACD Signal</label><div class="val" id="i-signal">‚Äî</div></div>
        <div class="ticker-item"><label>BB √ñvre</label><div class="val" id="i-bb-upper">‚Äî</div></div>
        <div class="ticker-item"><label>BB Mitten</label><div class="val" id="i-bb-mid">‚Äî</div></div>
        <div class="ticker-item"><label>BB Nedre</label><div class="val" id="i-bb-lower">‚Äî</div></div>
      </div>
      <div id="ind-status" style="font-size:0.65rem;color:var(--muted);margin-top:6px;">Kr√§ver Taapi-nyckel (taapi.io ‚Äî gratis konto)</div>
    </div>

    <div>
      <div class="section-title">Analysparametrar</div>
      <div class="params-grid">
        <div class="param-row">
          <div class="param-group"><label>Mitt k√∂ppris (USD)</label><input type="number" id="p-buyprice" placeholder="t.ex. 90000"></div>
          <div class="param-group"><label>Min position (BTC)</label><input type="number" id="p-amount" placeholder="t.ex. 0.5" step="0.001"></div>
        </div>
        <div class="param-row">
          <div class="param-group"><label>Stop-loss (USD)</label><input type="number" id="p-stoploss" placeholder="t.ex. 85000"></div>
          <div class="param-group"><label>Take-profit (USD)</label><input type="number" id="p-takeprofit" placeholder="t.ex. 100000"></div>
        </div>
        <div class="param-row">
          <div class="param-group"><label>RSI (14d) ‚Äî valfritt</label><input type="number" id="p-rsi" placeholder="t.ex. 62" min="0" max="100"></div>
          <div class="param-group"><label>Handelshorisont</label>
            <select id="p-horizon">
              <option value="daglig">Daglig (daytrading)</option>
              <option value="swing">Swing (1‚Äì7 dagar)</option>
              <option value="vecka">Vecka</option>
            </select>
          </div>
        </div>
        <div class="toggles">
          <div class="toggle-row"><input type="checkbox" id="p-news" checked><label for="p-news">Nyhetssentiment</label></div>
          <div class="toggle-row"><input type="checkbox" id="p-pnl" checked><label for="p-pnl">Ber√§kna P&L</label></div>
          <div class="toggle-row"><input type="checkbox" id="p-risk" checked><label for="p-risk">Riskbed√∂mning</label></div>
        </div>
        <div class="param-group">
          <label>Extra kontext / noteringar</label>
          <textarea id="p-notes" placeholder="T.ex. FED-m√∂te imorgon, jag tror p√• uppg√•ng baserat p√•..." style="min-height:55px;width:100%"></textarea>
        </div>
      </div>
    </div>

    <div>
      <div class="section-title">Daglig pushnotis</div>
      <div class="notif-box">
        <div style="font-size:.73rem;color:var(--muted);line-height:1.7">Aktivera f√∂r att f√• en AI-analys pushad till din enhet varje morgon. <b style="color:var(--text)">Appen m√•ste vara installerad p√• din telefon</b> (se Inst√§llningar ‚Üí Om appen).</div>
        <div class="notif-row">
          <label style="font-size:.66rem;color:var(--muted)">Tid:</label>
          <input type="time" class="notif-time" id="notifTime" value="07:00">
          <button class="notif-enable-btn" id="notifBtn" onclick="toggleNotifications()">Aktivera notiser</button>
          <span class="notif-status" id="notifStatus">Ej aktiverade</span>
        </div>
      </div>
    </div>

    <div style="display:flex;align-items:center;gap:10px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px;">
      <input type="checkbox" id="p-websearch" checked style="accent-color:var(--accent);width:14px;height:14px;">
      <label for="p-websearch" style="font-size:0.73rem;color:var(--text);cursor:pointer;flex:1">üîç S√∂k nyheter automatiskt (h√§mtar aktuella BTC-nyheter via Groq)</label>
    </div>
    <button class="analyze-btn" id="analyzeBtn" onclick="runAnalysis()">‚ñ∂ K√∂r daglig BTC-analys</button>

    <div>
      <div class="section-title">AI-Analys</div>
      <div class="btc-result" id="btcResult"><span class="result-placeholder">Tryck p√• "K√∂r daglig BTC-analys" f√∂r att starta...</span></div>
    </div>

  </div>
</div>

<!-- BYGGKALKYL -->
<div class="panel" id="panel-bygg">
  <div style="flex:1;overflow-y:auto;background:#0f0f0e;">
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.26.0/dist/umd/supabase.min.js"></script>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYmciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMWExYTEwIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzBhMGEwOCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ29sZCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmN2Q3NzQiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmNWM4NDIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojYzg5NjBhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJyaW5nIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4zIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4wNSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9Imdsb3ciPgogICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI4IiByZXN1bHQ9ImJsdXIiLz4KICAgICAgPGZlTWVyZ2U+PGZlTWVyZ2VOb2RlIGluPSJibHVyIi8+PGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+PC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgPC9kZWZzPgogIAogIDwhLS0gQmFja2dyb3VuZCAtLT4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjExMCIgZmlsbD0idXJsKCNiZykiLz4KICAKICA8IS0tIE91dGVyIHJpbmcgZ2xvdyAtLT4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ1cmwoI3JpbmcpIiBzdHJva2Utd2lkdGg9IjEuNSIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTk1IiBmaWxsPSJub25lIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4yIi8+CiAgCiAgPCEtLSBTdWJ0bGUgZ3JpZCBsaW5lcyAtLT4KICA8bGluZSB4MT0iODAiIHkxPSIyNTYiIHgyPSI0MzIiIHkyPSIyNTYiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZS1vcGFjaXR5PSIwLjA4Ii8+CiAgPGxpbmUgeDE9IjI1NiIgeTE9IjgwIiB4Mj0iMjU2IiB5Mj0iNDMyIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4wOCIvPgoKICA8IS0tIElubmVyIGNpcmNsZSBiYWNrZ3JvdW5kIC0tPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTc1IiBmaWxsPSIjMTMxMzEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxNzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2Utb3BhY2l0eT0iMC4xNSIvPgoKICA8IS0tIEJpdGNvaW4gQiBzeW1ib2wgLSBib2xkLCBzaGFycCwgbW9kZXJuIC0tPgogIDwhLS0gTGVmdCB2ZXJ0aWNhbCBiYXIgLS0+CiAgPHJlY3QgeD0iMTc4IiB5PSIxNDUiIHdpZHRoPSIzMiIgaGVpZ2h0PSIyMjIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIiBmaWx0ZXI9InVybCgjZ2xvdykiLz4KICAKICA8IS0tIFRvcCBidW1wIC0tPgogIDxyZWN0IHg9IjE3OCIgeT0iMTQ1IiB3aWR0aD0iOTgiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIyNDAiIHdpZHRoPSIxMTAiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIzMzUiIHdpZHRoPSI5OCIgaGVpZ2h0PSIzMiIgcng9IjYiIGZpbGw9InVybCgjZ29sZCkiLz4KICAKICA8IS0tIFRvcCBhcmMgLS0+CiAgPHBhdGggZD0iTSAyNzYgMTQ1IFEgMzQwIDE0NSAzNDAgMTk5IFEgMzQwIDI0MCAyNzYgMjQwIiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBCb3R0b20gYXJjIChzbGlnaHRseSB3aWRlcikgLS0+CiAgPHBhdGggZD0iTSAyODggMjQwIFEgMzU4IDI0MCAzNTggMjk1IFEgMzU4IDM2NyAyODggMzY3IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBUb3Agc2VyaWYgbGluZXMgKGNsYXNzaWMgQml0Y29pbiBzdHlsZSkgLS0+CiAgPHJlY3QgeD0iMjAyIiB5PSIxMjUiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KICA8cmVjdCB4PSIyNDgiIHk9IjEyNSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjI4IiByeD0iNCIgZmlsbD0idXJsKCNnb2xkKSIvPgogIDwhLS0gQm90dG9tIHNlcmlmIGxpbmVzIC0tPgogIDxyZWN0IHg9IjIwMiIgeT0iMzU5IiB3aWR0aD0iMjAiIGhlaWdodD0iMjgiIHJ4PSI0IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMjQ4IiB5PSIzNTkiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KCiAgPCEtLSBDb3JuZXIgZG90cyAvIGRlY29yYXRpdmUgLS0+CiAgPGNpcmNsZSBjeD0iMTI4IiBjeT0iMTI4IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgogIDxjaXJjbGUgY3g9IjM4NCIgY3k9IjEyOCIgcj0iNCIgZmlsbD0iI2Y1Yzg0MiIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KICA8Y2lyY2xlIGN4PSIxMjgiIGN5PSIzODQiIHI9IjQiIGZpbGw9IiNmNWM4NDIiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iMzg0IiBjeT0iMzg0IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgo8L3N2Zz4=">
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYmciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMWExYTEwIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzBhMGEwOCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ29sZCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmN2Q3NzQiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmNWM4NDIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojYzg5NjBhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJyaW5nIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4zIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4wNSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9Imdsb3ciPgogICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI4IiByZXN1bHQ9ImJsdXIiLz4KICAgICAgPGZlTWVyZ2U+PGZlTWVyZ2VOb2RlIGluPSJibHVyIi8+PGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+PC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgPC9kZWZzPgogIAogIDwhLS0gQmFja2dyb3VuZCAtLT4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjExMCIgZmlsbD0idXJsKCNiZykiLz4KICAKICA8IS0tIE91dGVyIHJpbmcgZ2xvdyAtLT4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ1cmwoI3JpbmcpIiBzdHJva2Utd2lkdGg9IjEuNSIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTk1IiBmaWxsPSJub25lIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4yIi8+CiAgCiAgPCEtLSBTdWJ0bGUgZ3JpZCBsaW5lcyAtLT4KICA8bGluZSB4MT0iODAiIHkxPSIyNTYiIHgyPSI0MzIiIHkyPSIyNTYiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZS1vcGFjaXR5PSIwLjA4Ii8+CiAgPGxpbmUgeDE9IjI1NiIgeTE9IjgwIiB4Mj0iMjU2IiB5Mj0iNDMyIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4wOCIvPgoKICA8IS0tIElubmVyIGNpcmNsZSBiYWNrZ3JvdW5kIC0tPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTc1IiBmaWxsPSIjMTMxMzEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxNzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2Utb3BhY2l0eT0iMC4xNSIvPgoKICA8IS0tIEJpdGNvaW4gQiBzeW1ib2wgLSBib2xkLCBzaGFycCwgbW9kZXJuIC0tPgogIDwhLS0gTGVmdCB2ZXJ0aWNhbCBiYXIgLS0+CiAgPHJlY3QgeD0iMTc4IiB5PSIxNDUiIHdpZHRoPSIzMiIgaGVpZ2h0PSIyMjIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIiBmaWx0ZXI9InVybCgjZ2xvdykiLz4KICAKICA8IS0tIFRvcCBidW1wIC0tPgogIDxyZWN0IHg9IjE3OCIgeT0iMTQ1IiB3aWR0aD0iOTgiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIyNDAiIHdpZHRoPSIxMTAiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIzMzUiIHdpZHRoPSI5OCIgaGVpZ2h0PSIzMiIgcng9IjYiIGZpbGw9InVybCgjZ29sZCkiLz4KICAKICA8IS0tIFRvcCBhcmMgLS0+CiAgPHBhdGggZD0iTSAyNzYgMTQ1IFEgMzQwIDE0NSAzNDAgMTk5IFEgMzQwIDI0MCAyNzYgMjQwIiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBCb3R0b20gYXJjIChzbGlnaHRseSB3aWRlcikgLS0+CiAgPHBhdGggZD0iTSAyODggMjQwIFEgMzU4IDI0MCAzNTggMjk1IFEgMzU4IDM2NyAyODggMzY3IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBUb3Agc2VyaWYgbGluZXMgKGNsYXNzaWMgQml0Y29pbiBzdHlsZSkgLS0+CiAgPHJlY3QgeD0iMjAyIiB5PSIxMjUiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KICA8cmVjdCB4PSIyNDgiIHk9IjEyNSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjI4IiByeD0iNCIgZmlsbD0idXJsKCNnb2xkKSIvPgogIDwhLS0gQm90dG9tIHNlcmlmIGxpbmVzIC0tPgogIDxyZWN0IHg9IjIwMiIgeT0iMzU5IiB3aWR0aD0iMjAiIGhlaWdodD0iMjgiIHJ4PSI0IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMjQ4IiB5PSIzNTkiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KCiAgPCEtLSBDb3JuZXIgZG90cyAvIGRlY29yYXRpdmUgLS0+CiAgPGNpcmNsZSBjeD0iMTI4IiBjeT0iMTI4IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgogIDxjaXJjbGUgY3g9IjM4NCIgY3k9IjEyOCIgcj0iNCIgZmlsbD0iI2Y1Yzg0MiIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KICA8Y2lyY2xlIGN4PSIxMjgiIGN5PSIzODQiIHI9IjQiIGZpbGw9IiNmNWM4NDIiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iMzg0IiBjeT0iMzg0IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgo8L3N2Zz4=">
<meta name="msapplication-TileImage" content="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYmciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMWExYTEwIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzBhMGEwOCIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ29sZCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmN2Q3NzQiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmNWM4NDIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojYzg5NjBhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJyaW5nIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4zIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6I2Y1Yzg0MjtzdG9wLW9wYWNpdHk6MC4wNSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxmaWx0ZXIgaWQ9Imdsb3ciPgogICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI4IiByZXN1bHQ9ImJsdXIiLz4KICAgICAgPGZlTWVyZ2U+PGZlTWVyZ2VOb2RlIGluPSJibHVyIi8+PGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+PC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgPC9kZWZzPgogIAogIDwhLS0gQmFja2dyb3VuZCAtLT4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjExMCIgZmlsbD0idXJsKCNiZykiLz4KICAKICA8IS0tIE91dGVyIHJpbmcgZ2xvdyAtLT4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ1cmwoI3JpbmcpIiBzdHJva2Utd2lkdGg9IjEuNSIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTk1IiBmaWxsPSJub25lIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4yIi8+CiAgCiAgPCEtLSBTdWJ0bGUgZ3JpZCBsaW5lcyAtLT4KICA8bGluZSB4MT0iODAiIHkxPSIyNTYiIHgyPSI0MzIiIHkyPSIyNTYiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZS1vcGFjaXR5PSIwLjA4Ii8+CiAgPGxpbmUgeDE9IjI1NiIgeTE9IjgwIiB4Mj0iMjU2IiB5Mj0iNDMyIiBzdHJva2U9IiNmNWM4NDIiIHN0cm9rZS13aWR0aD0iMC41IiBzdHJva2Utb3BhY2l0eT0iMC4wOCIvPgoKICA8IS0tIElubmVyIGNpcmNsZSBiYWNrZ3JvdW5kIC0tPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMTc1IiBmaWxsPSIjMTMxMzEwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMjU2IiByPSIxNzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2Y1Yzg0MiIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2Utb3BhY2l0eT0iMC4xNSIvPgoKICA8IS0tIEJpdGNvaW4gQiBzeW1ib2wgLSBib2xkLCBzaGFycCwgbW9kZXJuIC0tPgogIDwhLS0gTGVmdCB2ZXJ0aWNhbCBiYXIgLS0+CiAgPHJlY3QgeD0iMTc4IiB5PSIxNDUiIHdpZHRoPSIzMiIgaGVpZ2h0PSIyMjIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIiBmaWx0ZXI9InVybCgjZ2xvdykiLz4KICAKICA8IS0tIFRvcCBidW1wIC0tPgogIDxyZWN0IHg9IjE3OCIgeT0iMTQ1IiB3aWR0aD0iOTgiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIyNDAiIHdpZHRoPSIxMTAiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMTc4IiB5PSIzMzUiIHdpZHRoPSI5OCIgaGVpZ2h0PSIzMiIgcng9IjYiIGZpbGw9InVybCgjZ29sZCkiLz4KICAKICA8IS0tIFRvcCBhcmMgLS0+CiAgPHBhdGggZD0iTSAyNzYgMTQ1IFEgMzQwIDE0NSAzNDAgMTk5IFEgMzQwIDI0MCAyNzYgMjQwIiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBCb3R0b20gYXJjIChzbGlnaHRseSB3aWRlcikgLS0+CiAgPHBhdGggZD0iTSAyODggMjQwIFEgMzU4IDI0MCAzNTggMjk1IFEgMzU4IDM2NyAyODggMzY3IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZ29sZCkiIHN0cm9rZS13aWR0aD0iMzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsdGVyPSJ1cmwoI2dsb3cpIi8+CiAgCiAgPCEtLSBUb3Agc2VyaWYgbGluZXMgKGNsYXNzaWMgQml0Y29pbiBzdHlsZSkgLS0+CiAgPHJlY3QgeD0iMjAyIiB5PSIxMjUiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KICA8cmVjdCB4PSIyNDgiIHk9IjEyNSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjI4IiByeD0iNCIgZmlsbD0idXJsKCNnb2xkKSIvPgogIDwhLS0gQm90dG9tIHNlcmlmIGxpbmVzIC0tPgogIDxyZWN0IHg9IjIwMiIgeT0iMzU5IiB3aWR0aD0iMjAiIGhlaWdodD0iMjgiIHJ4PSI0IiBmaWxsPSJ1cmwoI2dvbGQpIi8+CiAgPHJlY3QgeD0iMjQ4IiB5PSIzNTkiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyOCIgcng9IjQiIGZpbGw9InVybCgjZ29sZCkiLz4KCiAgPCEtLSBDb3JuZXIgZG90cyAvIGRlY29yYXRpdmUgLS0+CiAgPGNpcmNsZSBjeD0iMTI4IiBjeT0iMTI4IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgogIDxjaXJjbGUgY3g9IjM4NCIgY3k9IjEyOCIgcj0iNCIgZmlsbD0iI2Y1Yzg0MiIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KICA8Y2lyY2xlIGN4PSIxMjgiIGN5PSIzODQiIHI9IjQiIGZpbGw9IiNmNWM4NDIiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iMzg0IiBjeT0iMzg0IiByPSI0IiBmaWxsPSIjZjVjODQyIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgo8L3N2Zz4=">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQUkgQXNzaXN0ZW50Iiwic2hvcnRfbmFtZSI6IkFJIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwYTBhMDgiLCJ0aGVtZV9jb2xvciI6IiNmNWM4NDIiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQTFNVElnTlRFeUlqNEtJQ0E4WkdWbWN6NEtJQ0FnSUR4c2FXNWxZWEpIY21Ga2FXVnVkQ0JwWkQwaVltY2lJSGd4UFNJd0pTSWdlVEU5SWpBbElpQjRNajBpTVRBd0pTSWdlVEk5SWpFd01DVWlQZ29nSUNBZ0lDQThjM1J2Y0NCdlptWnpaWFE5SWpBbElpQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pNV0V4WVRFd0lpOCtDaUFnSUNBZ0lEeHpkRzl3SUc5bVpuTmxkRDBpTVRBd0pTSWdjM1I1YkdVOUluTjBiM0F0WTI5c2IzSTZJekJoTUdFd09DSXZQZ29nSUNBZ1BDOXNhVzVsWVhKSGNtRmthV1Z1ZEQ0S0lDQWdJRHhzYVc1bFlYSkhjbUZrYVdWdWRDQnBaRDBpWjI5c1pDSWdlREU5SWpBbElpQjVNVDBpTUNVaUlIZ3lQU0l4TURBbElpQjVNajBpTVRBd0pTSStDaUFnSUNBZ0lEeHpkRzl3SUc5bVpuTmxkRDBpTUNVaUlITjBlV3hsUFNKemRHOXdMV052Ykc5eU9pTm1OMlEzTnpRaUx6NEtJQ0FnSUNBZ1BITjBiM0FnYjJabWMyVjBQU0kxTUNVaUlITjBlV3hsUFNKemRHOXdMV052Ykc5eU9pTm1OV000TkRJaUx6NEtJQ0FnSUNBZ1BITjBiM0FnYjJabWMyVjBQU0l4TURBbElpQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pZemc1TmpCaElpOCtDaUFnSUNBOEwyeHBibVZoY2tkeVlXUnBaVzUwUGdvZ0lDQWdQR3hwYm1WaGNrZHlZV1JwWlc1MElHbGtQU0p5YVc1bklpQjRNVDBpTUNVaUlIa3hQU0l3SlNJZ2VESTlJakV3TUNVaUlIa3lQU0l4TURBbElqNEtJQ0FnSUNBZ1BITjBiM0FnYjJabWMyVjBQU0l3SlNJZ2MzUjViR1U5SW5OMGIzQXRZMjlzYjNJNkkyWTFZemcwTWp0emRHOXdMVzl3WVdOcGRIazZNQzR6SWk4K0NpQWdJQ0FnSUR4emRHOXdJRzltWm5ObGREMGlNVEF3SlNJZ2MzUjViR1U5SW5OMGIzQXRZMjlzYjNJNkkyWTFZemcwTWp0emRHOXdMVzl3WVdOcGRIazZNQzR3TlNJdlBnb2dJQ0FnUEM5c2FXNWxZWEpIY21Ga2FXVnVkRDRLSUNBZ0lEeG1hV3gwWlhJZ2FXUTlJbWRzYjNjaVBnb2dJQ0FnSUNBOFptVkhZWFZ6YzJsaGJrSnNkWElnYzNSa1JHVjJhV0YwYVc5dVBTSTRJaUJ5WlhOMWJIUTlJbUpzZFhJaUx6NEtJQ0FnSUNBZ1BHWmxUV1Z5WjJVK1BHWmxUV1Z5WjJWT2IyUmxJR2x1UFNKaWJIVnlJaTgrUEdabFRXVnlaMlZPYjJSbElHbHVQU0pUYjNWeVkyVkhjbUZ3YUdsaklpOCtQQzltWlUxbGNtZGxQZ29nSUNBZ1BDOW1hV3gwWlhJK0NpQWdQQzlrWldaelBnb2dJQW9nSUR3aExTMGdRbUZqYTJkeWIzVnVaQ0F0TFQ0S0lDQThjbVZqZENCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlnY25nOUlqRXhNQ0lnWm1sc2JEMGlkWEpzS0NOaVp5a2lMejRLSUNBS0lDQThJUzB0SUU5MWRHVnlJSEpwYm1jZ1oyeHZkeUF0TFQ0S0lDQThZMmx5WTJ4bElHTjRQU0l5TlRZaUlHTjVQU0l5TlRZaUlISTlJakl4TUNJZ1ptbHNiRDBpYm05dVpTSWdjM1J5YjJ0bFBTSjFjbXdvSTNKcGJtY3BJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqRXVOU0l2UGdvZ0lEeGphWEpqYkdVZ1kzZzlJakkxTmlJZ1kzazlJakkxTmlJZ2NqMGlNVGsxSWlCbWFXeHNQU0p1YjI1bElpQnpkSEp2YTJVOUlpTm1OV000TkRJaUlITjBjbTlyWlMxM2FXUjBhRDBpTUM0MUlpQnpkSEp2YTJVdGIzQmhZMmwwZVQwaU1DNHlJaTgrQ2lBZ0NpQWdQQ0V0TFNCVGRXSjBiR1VnWjNKcFpDQnNhVzVsY3lBdExUNEtJQ0E4YkdsdVpTQjRNVDBpT0RBaUlIa3hQU0l5TlRZaUlIZ3lQU0kwTXpJaUlIa3lQU0l5TlRZaUlITjBjbTlyWlQwaUkyWTFZemcwTWlJZ2MzUnliMnRsTFhkcFpIUm9QU0l3TGpVaUlITjBjbTlyWlMxdmNHRmphWFI1UFNJd0xqQTRJaTgrQ2lBZ1BHeHBibVVnZURFOUlqSTFOaUlnZVRFOUlqZ3dJaUI0TWowaU1qVTJJaUI1TWowaU5ETXlJaUJ6ZEhKdmEyVTlJaU5tTldNNE5ESWlJSE4wY205clpTMTNhV1IwYUQwaU1DNDFJaUJ6ZEhKdmEyVXRiM0JoWTJsMGVUMGlNQzR3T0NJdlBnb0tJQ0E4SVMwdElFbHVibVZ5SUdOcGNtTnNaU0JpWVdOclozSnZkVzVrSUMwdFBnb2dJRHhqYVhKamJHVWdZM2c5SWpJMU5pSWdZM2s5SWpJMU5pSWdjajBpTVRjMUlpQm1hV3hzUFNJak1UTXhNekV3SWk4K0NpQWdQR05wY21Oc1pTQmplRDBpTWpVMklpQmplVDBpTWpVMklpQnlQU0l4TnpRaUlHWnBiR3c5SW01dmJtVWlJSE4wY205clpUMGlJMlkxWXpnME1pSWdjM1J5YjJ0bExYZHBaSFJvUFNJeElpQnpkSEp2YTJVdGIzQmhZMmwwZVQwaU1DNHhOU0l2UGdvS0lDQThJUzB0SUVKcGRHTnZhVzRnUWlCemVXMWliMndnTFNCaWIyeGtMQ0J6YUdGeWNDd2diVzlrWlhKdUlDMHRQZ29nSUR3aExTMGdUR1ZtZENCMlpYSjBhV05oYkNCaVlYSWdMUzArQ2lBZ1BISmxZM1FnZUQwaU1UYzRJaUI1UFNJeE5EVWlJSGRwWkhSb1BTSXpNaUlnYUdWcFoyaDBQU0l5TWpJaUlISjRQU0kySWlCbWFXeHNQU0oxY213b0kyZHZiR1FwSWlCbWFXeDBaWEk5SW5WeWJDZ2paMnh2ZHlraUx6NEtJQ0FLSUNBOElTMHRJRlJ2Y0NCaWRXMXdJQzB0UGdvZ0lEeHlaV04wSUhnOUlqRTNPQ0lnZVQwaU1UUTFJaUIzYVdSMGFEMGlPVGdpSUdobGFXZG9kRDBpTXpJaUlISjRQU0kySWlCbWFXeHNQU0oxY213b0kyZHZiR1FwSWk4K0NpQWdQSEpsWTNRZ2VEMGlNVGM0SWlCNVBTSXlOREFpSUhkcFpIUm9QU0l4TVRBaUlHaGxhV2RvZEQwaU16SWlJSEo0UFNJMklpQm1hV3hzUFNKMWNtd29JMmR2YkdRcElpOCtDaUFnUEhKbFkzUWdlRDBpTVRjNElpQjVQU0l6TXpVaUlIZHBaSFJvUFNJNU9DSWdhR1ZwWjJoMFBTSXpNaUlnY25nOUlqWWlJR1pwYkd3OUluVnliQ2dqWjI5c1pDa2lMejRLSUNBS0lDQThJUzB0SUZSdmNDQmhjbU1nTFMwK0NpQWdQSEJoZEdnZ1pEMGlUU0F5TnpZZ01UUTFJRkVnTXpRd0lERTBOU0F6TkRBZ01UazVJRkVnTXpRd0lESTBNQ0F5TnpZZ01qUXdJaUJtYVd4c1BTSnViMjVsSWlCemRISnZhMlU5SW5WeWJDZ2paMjlzWkNraUlITjBjbTlyWlMxM2FXUjBhRDBpTXpJaUlITjBjbTlyWlMxc2FXNWxZMkZ3UFNKeWIzVnVaQ0lnWm1sc2RHVnlQU0oxY213b0kyZHNiM2NwSWk4K0NpQWdDaUFnUENFdExTQkNiM1IwYjIwZ1lYSmpJQ2h6YkdsbmFIUnNlU0IzYVdSbGNpa2dMUzArQ2lBZ1BIQmhkR2dnWkQwaVRTQXlPRGdnTWpRd0lGRWdNelU0SURJME1DQXpOVGdnTWprMUlGRWdNelU0SURNMk55QXlPRGdnTXpZM0lpQm1hV3hzUFNKdWIyNWxJaUJ6ZEhKdmEyVTlJblZ5YkNnaloyOXNaQ2tpSUhOMGNtOXJaUzEzYVdSMGFEMGlNeklpSUhOMGNtOXJaUzFzYVc1bFkyRndQU0p5YjNWdVpDSWdabWxzZEdWeVBTSjFjbXdvSTJkc2IzY3BJaTgrQ2lBZ0NpQWdQQ0V0TFNCVWIzQWdjMlZ5YVdZZ2JHbHVaWE1nS0dOc1lYTnphV01nUW1sMFkyOXBiaUJ6ZEhsc1pTa2dMUzArQ2lBZ1BISmxZM1FnZUQwaU1qQXlJaUI1UFNJeE1qVWlJSGRwWkhSb1BTSXlNQ0lnYUdWcFoyaDBQU0l5T0NJZ2NuZzlJalFpSUdacGJHdzlJblZ5YkNnaloyOXNaQ2tpTHo0S0lDQThjbVZqZENCNFBTSXlORGdpSUhrOUlqRXlOU0lnZDJsa2RHZzlJakl3SWlCb1pXbG5hSFE5SWpJNElpQnllRDBpTkNJZ1ptbHNiRDBpZFhKc0tDTm5iMnhrS1NJdlBnb2dJRHdoTFMwZ1FtOTBkRzl0SUhObGNtbG1JR3hwYm1WeklDMHRQZ29nSUR4eVpXTjBJSGc5SWpJd01pSWdlVDBpTXpVNUlpQjNhV1IwYUQwaU1qQWlJR2hsYVdkb2REMGlNamdpSUhKNFBTSTBJaUJtYVd4c1BTSjFjbXdvSTJkdmJHUXBJaTgrQ2lBZ1BISmxZM1FnZUQwaU1qUTRJaUI1UFNJek5Ua2lJSGRwWkhSb1BTSXlNQ0lnYUdWcFoyaDBQU0l5T0NJZ2NuZzlJalFpSUdacGJHdzlJblZ5YkNnaloyOXNaQ2tpTHo0S0NpQWdQQ0V0TFNCRGIzSnVaWElnWkc5MGN5QXZJR1JsWTI5eVlYUnBkbVVnTFMwK0NpQWdQR05wY21Oc1pTQmplRDBpTVRJNElpQmplVDBpTVRJNElpQnlQU0kwSWlCbWFXeHNQU0lqWmpWak9EUXlJaUJtYVd4c0xXOXdZV05wZEhrOUlqQXVNeUl2UGdvZ0lEeGphWEpqYkdVZ1kzZzlJak00TkNJZ1kzazlJakV5T0NJZ2NqMGlOQ0lnWm1sc2JEMGlJMlkxWXpnME1pSWdabWxzYkMxdmNHRmphWFI1UFNJd0xqTWlMejRLSUNBOFkybHlZMnhsSUdONFBTSXhNamdpSUdONVBTSXpPRFFpSUhJOUlqUWlJR1pwYkd3OUlpTm1OV000TkRJaUlHWnBiR3d0YjNCaFkybDBlVDBpTUM0eklpOCtDaUFnUEdOcGNtTnNaU0JqZUQwaU16ZzBJaUJqZVQwaU16ZzBJaUJ5UFNJMElpQm1hV3hzUFNJalpqVmpPRFF5SWlCbWFXeHNMVzl3WVdOcGRIazlJakF1TXlJdlBnbzhMM04yWno0PSIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIiwicHVycG9zZSI6ImFueSBtYXNrYWJsZSJ9XX0=">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- AUTH -->
<div id="auth-screen">
  <div class="auth-logo">Byggkalkyl</div>
  <div class="auth-sub">Offertverktyg f√∂r byggf√∂retag</div>
  <div class="auth-card">
    <div class="auth-tabs">
      <div class="auth-tab active" onclick="authTab('login')">Logga in</div>
      <div class="auth-tab" onclick="authTab('register')">Skapa konto</div>
    </div>
    <label>E-post</label>
    <input type="email" id="auth-email" placeholder="din@email.se" autocomplete="email">
    <label>L√∂senord</label>
    <input type="password" id="auth-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
    <button class="btn btn-primary" id="auth-btn" onclick="authSubmit()">Logga in</button>
    <div class="auth-error" id="auth-error"></div>
    <div class="auth-info" id="auth-info"></div>
  </div>
</div>

<!-- APP -->
<div id="app-screen">
  <nav>
    <div class="nav-logo">Byggkalkyl</div>
    <div class="nav-tabs">
      <div class="nav-tab active" onclick="byggShowPage('kalkyl')">Kalkyl</div>
      <div class="nav-tab" onclick="byggShowPage('offert')">Offert</div>
      <div class="nav-tab" onclick="byggShowPage('sparade')">Sparade</div>
      <div class="nav-tab" onclick="byggShowPage('materialdb')">Material</div>
      <div class="nav-tab" onclick="byggShowPage('installningar')">Inst√§lln.</div>
    </div>
    <div class="nav-user" onclick="loggaUt()" title="Logga ut">‚éã</div>
  </nav>

  <!-- KALKYL -->
  <div class="page active" id="page-kalkyl">
    <div class="page-header"><h1>Ny kalkyl</h1><p>Fyll i arbete, material och tid</p></div>

    <div class="card">
      <div class="card-title">Kundinformation</div>
      <label>Kundens namn</label>
      <input type="text" id="kund-namn" placeholder="Anna Andersson">
      <label>Adress (arbetsplats)</label>
      <input type="text" id="kund-adress" placeholder="Storgatan 12, 831 30 √ñstersund">
      <div class="row2">
        <div><label>Offertnummer</label><input type="text" id="offert-nr" placeholder="2025-001"></div>
        <div><label>Giltighetstid</label><input type="text" id="offert-giltig" placeholder="30 dagar"></div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Arbetsbeskrivning</div>
      <p style="font-size:13px;color:var(--muted);margin-bottom:14px;">Specificera vad som ing√•r i arbetet</p>
      <div id="arbetsteg-list"></div>
      <button class="btn btn-add" onclick="laggTillSteg()">+ L√§gg till arbetssteg</button>
    </div>

    <div class="card">
      <div class="card-title">Material i kalkylen</div>
      <p style="font-size:13px;color:var(--muted);margin-bottom:12px;">S√∂k i din materialdatabas eller l√§gg till manuellt</p>
      <div class="search-wrap" style="margin-bottom:10px;">
        <input type="text" id="mat-sok" placeholder="üîç S√∂k material..." oninput="sokMaterial(this.value)" autocomplete="off">
        <div class="search-dropdown" id="mat-dropdown" style="display:none;"></div>
      </div>
      <div id="mat-col-header" style="display:flex;gap:8px;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.06em;padding:0 0 6px;border-bottom:1px solid var(--border);margin-bottom:4px;">
        <span style="flex:1">Material</span><span style="width:65px;text-align:center">Antal</span><span style="width:40px;text-align:center">Enhet</span><span style="width:80px;text-align:right">Pris/st</span><span style="width:36px"></span>
      </div>
      <div id="kalkyl-mat-list"></div>
      <button class="btn btn-add" onclick="laggTillKalkylMatManuellt()">+ L√§gg till manuellt</button>
    </div>

    <div class="card">
      <div class="card-title">Arbetstid</div>
      <div class="row2">
        <div><label>Antal timmar</label><input type="number" id="timmar" placeholder="0" min="0" oninput="rakna()"></div>
        <div><label>Timpris (inkl moms)</label><input type="number" id="timpris" value="650" readonly style="color:var(--muted)"></div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ROT-avdrag <span class="badge badge-rot">30%</span></div>
      <div class="setting-row" style="padding:0 0 12px;border-bottom:1px solid var(--border);">
        <div>
          <div class="setting-label">Aktivera ROT-avdrag</div>
          <div class="setting-sub">30% av arbetskostnad inkl. moms ¬∑ max 50 000 kr/person</div>
        </div>
        <label class="toggle"><input type="checkbox" id="rot-toggle" onchange="rakna()"><span class="toggle-slider"></span></label>
      </div>
      <div id="rot-info" style="display:none;padding-top:12px;">
        <label>Antal personer (fastighets√§gare)</label>
        <input type="number" id="rot-personer" value="1" min="1" max="2" oninput="rakna()">
        <div style="font-size:12px;color:var(--muted);margin-top:6px;">Max ROT-avdrag: <span id="max-rot-text">50 000 kr</span></div>
      </div>
    </div>

    <div class="summary-box">
      <div class="sum-row"><span>Materialkostnad (inkl moms)</span><span class="sum-val" id="s-material">0 kr</span></div>
      <div class="sum-row"><span>Arbetskostnad (inkl moms)</span><span class="sum-val" id="s-arbete">0 kr</span></div>
      <div class="sum-row big"><span>Totalt f√∂re ROT</span><span class="sum-val" id="s-total">0 kr</span></div>
      <div class="sum-row rot-row" id="rot-rad" style="display:none;"><span>ROT-avdrag (‚Äì)</span><span class="sum-val" id="s-rot">0 kr</span></div>
      <div class="sum-row final-row"><span>Kunden betalar</span><span class="sum-val" id="s-final">0 kr</span></div>
    </div>

    <div style="display:flex;gap:10px;margin-top:20px;">
      <button class="btn btn-primary" onclick="skapaOffert()" style="flex:2;">Skapa offert ‚Üí</button>
      <button class="btn btn-ghost" onclick="sparaOffert()" style="flex:1;" id="spara-btn">üíæ Spara</button>
    </div>
  </div>

  <!-- OFFERT -->
  <div class="page" id="page-offert">
    <div class="page-header"><h1>Offert</h1><p>Granska och skriv ut</p></div>
    <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;">
      <button class="btn btn-ghost" onclick="window.print()">üñ® Skriv ut / PDF</button>
      <button class="btn btn-ghost" onclick="kopieraText()">üìã Kopiera</button>
      <button class="btn btn-ghost" onclick="nollstallKalkyl()">+ Ny kalkyl</button>
    </div>
    <div class="card offer-card">
      <div class="offer-preview" id="offert-preview">
        <div style="text-align:center;color:#999;padding:40px 0;">G√• till Kalkyl och klicka p√• "Skapa offert"</div>
      </div>
    </div>
  </div>

  <!-- SPARADE OFFERTER -->
  <div class="page" id="page-sparade">
    <div class="page-header"><h1>Sparade offerter</h1><p>√ñppna, redigera eller ta bort</p></div>
    <div class="card">
      <input type="text" id="sparade-filter" placeholder="S√∂k p√• kund eller offertnummer..." oninput="filterSparade()" style="margin-bottom:14px;">
      <div id="sparade-list"><div style="color:var(--muted);font-size:14px;">Laddar...</div></div>
    </div>
  </div>

  <!-- MATERIALDATABAS -->
  <div class="page" id="page-materialdb">
    <div class="page-header"><h1>Materialdatabas</h1><p>Bygg upp ditt eget register ‚Äî sparas i molnet</p></div>

    <div class="card">
      <div class="card-title">L√§gg till material</div>
      <label>Materialnamn</label>
      <input type="text" id="db-nytt-namn" placeholder="t.ex. Klinker 60x60 antracit">
      <div class="row2">
        <div><label>Enhet</label><input type="text" id="db-nytt-enhet" placeholder="m¬≤, st, l√∂pm, kg"></div>
        <div><label>Pris per enhet (kr)</label><input type="number" id="db-nytt-pris" placeholder="0" min="0"></div>
      </div>
      <label>Kategori (valfritt)</label>
      <input type="text" id="db-nytt-kat" placeholder="t.ex. Golv, Kakel, Tr√§, Isolering">
      <button class="btn btn-primary" onclick="laggTillDBMaterial()" id="db-spara-btn" style="margin-top:14px;">+ Spara i databasen</button>
    </div>

    <div class="card">
      <div class="card-title">Sparat material</div>
      <input type="text" id="db-filter" placeholder="Filtrera..." oninput="renderDB()" style="margin-bottom:14px;">
      <div id="db-list"><div style="color:var(--muted);font-size:14px;">Laddar...</div></div>
    </div>
  </div>

  <!-- INST√ÑLLNINGAR -->
  <div class="page" id="page-installningar">
    <div class="page-header"><h1>Inst√§llningar</h1><p>Sparas automatiskt i molnet</p></div>

    <div class="card">
      <div class="card-title">Logotyp i offerten</div>
      <div class="logo-upload-area" onclick="document.getElementById('logo-input').click()">
        <img id="logo-preview-img" class="logo-preview-img" style="display:none;">
        <div id="logo-placeholder">
          <div style="font-size:28px;margin-bottom:8px;">üñº</div>
          <div style="font-size:14px;color:var(--muted);">Tryck f√∂r att ladda upp logotyp</div>
        </div>
        <div class="logo-hint">PNG, JPG eller SVG ¬∑ Visas i offertens √∂vre v√§nstra h√∂rn</div>
      </div>
      <input type="file" id="logo-input" accept="image/*" style="display:none;" onchange="laddaLogo(this)">
      <button class="btn btn-ghost" onclick="taBortLogo()" style="margin-top:10px;width:100%;font-size:13px;">Ta bort logotyp</button>
    </div>

    <div class="card">
      <div class="card-title">Ditt f√∂retag</div>
      <label>F√∂retagsnamn</label><input type="text" id="foretag-namn" placeholder="Ditt Bygg AB">
      <label>Org.nummer</label><input type="text" id="foretag-org" placeholder="556123-4567">
      <label>Telefon</label><input type="tel" id="foretag-tel" placeholder="070-000 00 00">
      <label>E-post</label><input type="email" id="foretag-email" placeholder="info@dittforetag.se">
      <label>Adress</label><input type="text" id="foretag-adress" placeholder="Storgatan 1, 831 30 √ñstersund">
      <label>Hemsida</label><input type="text" id="foretag-webb" placeholder="www.dittforetag.se">
      <button class="btn btn-primary" onclick="sparaInstallningar()" style="margin-top:16px;">üíæ Spara inst√§llningar</button>
    </div>

    <div class="card">
      <div class="card-title">Priss√§ttning</div>
      <div class="setting-row">
        <div><div class="setting-label">Timpris (inkl moms)</div><div class="setting-sub">Visas ej i offerten</div></div>
        <input type="number" id="inst-timpris" value="650">
      </div>
    </div>

    <div class="card">
      <div class="card-title">Standardvillkor</div>
      <label>Villkorstext (visas i offerten)</label>
      <textarea id="villkor-text" rows="6">Betalningsvillkor: 30 dagar netto.
Dr√∂jsm√•lsr√§nta: 8% per √•r.
Priser inkl. moms om inget annat anges.
ROT-avdrag hanteras mot Skatteverket av utf√∂raren.
Till√§ggsarbeten faktureras enligt l√∂pande r√§kning.
Tvister avg√∂rs enligt svensk r√§tt.</textarea>
      <button class="btn btn-primary" onclick="sparaInstallningar()" style="margin-top:12px;">üíæ Spara villkor</button>
    </div>

    <div class="card" style="border-color:#3a1e1e;">
      <div class="card-title" style="color:#e07070;">Konto</div>
      <button class="btn btn-danger" onclick="loggaUt()" style="width:100%;">Logga ut</button>
    </div>
  </div>
</div>

<script>
// ===== SUPABASE =====
const SUPA_URL = 'https://ujdmhxmmmwezjqlqgyop.supabase.co';
const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqZG1oeG1tbXdlempxbHFneW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MzMxMzQsImV4cCI6MjA4NzEwOTEzNH0._amp-h4zm_8zMHM1jxj0zKU6DnPj5XH8LGk_pro6UXg';
const sb = supabase.createClient(SUPA_URL, SUPA_KEY);

let currentUser = null;
let arbetsteg = [];
let kalkylMat = [];
let materialDB = [];
let logoBase64 = null;
let instCache = {};
let authMode = 'login';

// ===== HELPERS =====
function fmt(n) { return Math.round(n).toLocaleString('sv-SE') + ' kr'; }
function escHtml(s) { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

function showToast(msg, type='success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast ' + type;
  t.style.display = 'block';
  setTimeout(() => t.style.display = 'none', 3000);
}

// ===== AUTH =====
function authTab(mode) {
  authMode = mode;
  document.querySelectorAll('.auth-tab').forEach((t,i) => t.classList.toggle('active', (i===0&&mode==='login')||(i===1&&mode==='register')));
  document.getElementById('auth-btn').textContent = mode === 'login' ? 'Logga in' : 'Skapa konto';
  document.getElementById('auth-error').style.display = 'none';
  document.getElementById('auth-info').style.display = 'none';
}

async function authSubmit() {
  const email = document.getElementById('auth-email').value.trim();
  const pw = document.getElementById('auth-password').value;
  const btn = document.getElementById('auth-btn');
  const errEl = document.getElementById('auth-error');
  const infoEl = document.getElementById('auth-info');
  errEl.style.display = 'none';
  infoEl.style.display = 'none';
  btn.innerHTML = '<span class="spinner"></span>';
  btn.disabled = true;

  try {
    if (authMode === 'login') {
      const { error } = await sb.auth.signInWithPassword({ email, password: pw });
      if (error) throw error;
      await initSession();
      return;
    } else {
      const { error } = await sb.auth.signUp({ email, password: pw });
      if (error) throw error;
      infoEl.textContent = 'Konto skapat! Kontrollera din e-post f√∂r att bekr√§fta, sedan kan du logga in.';
      infoEl.style.display = 'block';
      btn.innerHTML = 'Skapa konto';
      btn.disabled = false;
      return;
    }
  } catch(e) {
    errEl.textContent = e.message || 'N√•got gick fel';
    errEl.style.display = 'block';
    btn.innerHTML = authMode === 'login' ? 'Logga in' : 'Skapa konto';
    btn.disabled = false;
  }
}

function loggaUt() {
  // Clear session from localStorage directly ‚Äî avoids LockManager hang
  Object.keys(localStorage).forEach(k => {
    if (k.startsWith('sb-') || k.includes('supabase')) localStorage.removeItem(k);
  });
  currentUser = null;
  document.getElementById('app-screen').style.display = 'none';
  document.getElementById('auth-screen').style.display = 'flex';
}

// ===== SESSION =====
async function initSession() {
  try {
    const { data: { session } } = await sb.auth.getSession();
    if (session?.user) {
      currentUser = session.user;
      document.getElementById('auth-screen').style.display = 'none';
      document.getElementById('app-screen').style.display = 'block';
      await Promise.all([laddaInstallningar(), laddaDB()]);
      rakna();
      const yr = new Date().getFullYear();
      document.getElementById('offert-nr').value = `${yr}-001`;
      laggTillSteg();
    } else {
      document.getElementById('auth-screen').style.display = 'flex';
      document.getElementById('app-screen').style.display = 'none';
    }
  } catch(e) {
    console.log('Session error:', e);
    document.getElementById('auth-screen').style.display = 'flex';
    document.getElementById('app-screen').style.display = 'none';
  }
}

// Run on load
document.addEventListener('DOMContentLoaded', initSession);

// ===== NAV =====
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  const idx = ['kalkyl','offert','sparade','materialdb','installningar'].indexOf(id);
  document.querySelectorAll('.nav-tab')[idx]?.classList.add('active');
  if (id === 'materialdb') renderDB();
  if (id === 'sparade') laddaSparadeOfferter();
}

// ===== LOGO =====
function laddaLogo(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    logoBase64 = e.target.result;
    document.getElementById('logo-preview-img').src = logoBase64;
    document.getElementById('logo-preview-img').style.display = 'block';
    document.getElementById('logo-placeholder').style.display = 'none';
  };
  reader.readAsDataURL(file);
}
function taBortLogo() {
  logoBase64 = null;
  document.getElementById('logo-preview-img').style.display = 'none';
  document.getElementById('logo-placeholder').style.display = 'block';
}

// ===== INST√ÑLLNINGAR =====
function getInst() {
  return {
    foretag_namn: document.getElementById('foretag-namn')?.value || '',
    foretag_org: document.getElementById('foretag-org')?.value || '',
    foretag_tel: document.getElementById('foretag-tel')?.value || '',
    foretag_email: document.getElementById('foretag-email')?.value || '',
    foretag_adress: document.getElementById('foretag-adress')?.value || '',
    foretag_webb: document.getElementById('foretag-webb')?.value || '',
    timpris: parseFloat(document.getElementById('inst-timpris')?.value || 650),
    villkor: document.getElementById('villkor-text')?.value || '',
    logo_base64: logoBase64 || null
  };
}

async function sparaInstallningar() {
  const btn = document.querySelector('#page-installningar .btn-primary');
  if (btn) { btn.innerHTML = '<span class="spinner"></span> Sparar...'; btn.disabled = true; }

  const inst = getInst();
  inst.user_id = currentUser.id;

  // Kolla om rad redan finns
  const { data: existing } = await sb.from('installningar').select('id').eq('user_id', currentUser.id).maybeSingle();

  let error;
  if (existing) {
    ({ error } = await sb.from('installningar').update(inst).eq('user_id', currentUser.id));
  } else {
    ({ error } = await sb.from('installningar').insert(inst));
  }

  if (btn) { btn.innerHTML = 'üíæ Spara inst√§llningar'; btn.disabled = false; }

  if (error) {
    showToast('Fel: ' + error.message, 'error');
    alert('Fel vid sparande: ' + error.message + ' (Kod: ' + (error.code || '?') + ')');
    return;
  }
  instCache = inst;
  showToast('‚úì Inst√§llningar sparade');
}

async function laddaInstallningar() {
  const { data, error } = await sb.from('installningar').select('*').eq('user_id', currentUser.id).single();
  if (error || !data) return;
  instCache = data;
  if (data.foretag_namn) document.getElementById('foretag-namn').value = data.foretag_namn;
  if (data.foretag_org) document.getElementById('foretag-org').value = data.foretag_org;
  if (data.foretag_tel) document.getElementById('foretag-tel').value = data.foretag_tel;
  if (data.foretag_email) document.getElementById('foretag-email').value = data.foretag_email;
  if (data.foretag_adress) document.getElementById('foretag-adress').value = data.foretag_adress;
  if (data.foretag_webb) document.getElementById('foretag-webb').value = data.foretag_webb;
  if (data.timpris) { document.getElementById('inst-timpris').value = data.timpris; document.getElementById('timpris').value = data.timpris; }
  if (data.villkor) document.getElementById('villkor-text').value = data.villkor;
  if (data.logo_base64) {
    logoBase64 = data.logo_base64;
    document.getElementById('logo-preview-img').src = logoBase64;
    document.getElementById('logo-preview-img').style.display = 'block';
    document.getElementById('logo-placeholder').style.display = 'none';
  }
}

// ===== ARBETSTEG =====
function renderArbetsteg() {
  const list = document.getElementById('arbetsteg-list');
  list.innerHTML = '';
  arbetsteg.forEach((steg, i) => {
    const row = document.createElement('div');
    row.className = 'arbetsteg-row';
    row.innerHTML = `<div class="step-num">${i+1}</div>
      <input type="text" value="${escHtml(steg)}" placeholder="Beskriv arbetssteg..." oninput="arbetsteg[${i}]=this.value">
      <button class="btn btn-danger" onclick="taBortSteg(${i})">‚úï</button>`;
    list.appendChild(row);
  });
}
function laggTillSteg() { arbetsteg.push(''); renderArbetsteg(); const inp = document.querySelectorAll('#arbetsteg-list input'); inp[inp.length-1]?.focus(); }
function taBortSteg(i) { arbetsteg.splice(i,1); renderArbetsteg(); }

// ===== KALKYL MATERIAL =====
function renderKalkylMat() {
  const list = document.getElementById('kalkyl-mat-list');
  const header = document.getElementById('mat-col-header');
  list.innerHTML = '';
  header.style.display = kalkylMat.length > 0 ? 'flex' : 'none';
  kalkylMat.forEach((m, i) => {
    const row = document.createElement('div');
    row.className = 'mat-row';
    row.innerHTML = `
      <input class="mat-name" type="text" value="${escHtml(m.namn)}" placeholder="Materialnamn" oninput="kalkylMat[${i}].namn=this.value">
      <input class="mat-qty" type="number" value="${m.antal}" min="0" oninput="kalkylMat[${i}].antal=parseFloat(this.value)||0;rakna()">
      <div class="mat-unit">${escHtml(m.enhet)}</div>
      <div class="mat-price">${m.pris} kr</div>
      <button class="btn btn-danger" onclick="taBortKalkylMat(${i})">‚úï</button>`;
    list.appendChild(row);
  });
  rakna();
}
function laggTillKalkylMat(mat) { kalkylMat.push({ namn: mat.namn, antal: 1, enhet: mat.enhet, pris: mat.pris }); renderKalkylMat(); }
function laggTillKalkylMatManuellt() { kalkylMat.push({ namn: '', antal: 1, enhet: 'st', pris: 0 }); renderKalkylMat(); }
function taBortKalkylMat(i) { kalkylMat.splice(i,1); renderKalkylMat(); rakna(); }

// ===== SEARCH =====
function sokMaterial(q) {
  const dd = document.getElementById('mat-dropdown');
  if (!q) { dd.style.display = 'none'; return; }
  const hits = materialDB.filter(m => m.namn.toLowerCase().includes(q.toLowerCase()) || (m.kategori||'').toLowerCase().includes(q.toLowerCase()));
  if (!hits.length) { dd.style.display = 'none'; return; }
  dd.innerHTML = hits.map(m => `<div class="search-item" onclick="vaeljMaterial('${m.id}')">
    <div>${escHtml(m.namn)} <span style="font-size:11px;color:var(--muted)">${m.kategori ? '¬∑ '+m.kategori : ''}</span></div>
    <div class="si-meta">${m.pris} kr/${m.enhet}</div>
  </div>`).join('');
  dd.style.display = 'block';
}
function vaeljMaterial(id) {
  const m = materialDB.find(x => x.id === id);
  if (m) laggTillKalkylMat({ namn: m.namn, enhet: m.enhet, pris: m.pris });
  document.getElementById('mat-sok').value = '';
  document.getElementById('mat-dropdown').style.display = 'none';
}
document.addEventListener('click', e => { if (!e.target.closest('.search-wrap')) document.getElementById('mat-dropdown').style.display = 'none'; });

// ===== MATERIALDATABAS =====
async function laddaDB() {
  const { data } = await sb.from('material').select('*').eq('user_id', currentUser.id).order('namn');
  materialDB = data || [];
  renderDB();
}

async function laggTillDBMaterial() {
  const namn = document.getElementById('db-nytt-namn').value.trim();
  const enhet = document.getElementById('db-nytt-enhet').value.trim() || 'st';
  const pris = parseFloat(document.getElementById('db-nytt-pris').value) || 0;
  const kategori = document.getElementById('db-nytt-kat').value.trim();
  if (!namn) { showToast('Ange ett materialnamn', 'error'); return; }

  const btn = document.getElementById('db-spara-btn');
  btn.innerHTML = '<span class="spinner"></span> Sparar...';
  btn.disabled = true;

  const { data, error } = await sb.from('material').insert({ user_id: currentUser.id, namn, enhet, pris, kategori }).select().single();
  btn.innerHTML = '+ Spara i databasen'; btn.disabled = false;
  if (error) { showToast('Fel: ' + error.message, 'error'); return; }

  materialDB.push(data);
  materialDB.sort((a,b) => a.namn.localeCompare(b.namn));
  document.getElementById('db-nytt-namn').value = '';
  document.getElementById('db-nytt-enhet').value = '';
  document.getElementById('db-nytt-pris').value = '';
  document.getElementById('db-nytt-kat').value = '';
  renderDB();
  showToast('‚úì ' + namn + ' sparad i databasen');
}

function renderDB() {
  const filter = (document.getElementById('db-filter')?.value || '').toLowerCase();
  const list = document.getElementById('db-list');
  const filtered = materialDB.filter(m => m.namn.toLowerCase().includes(filter) || (m.kategori||'').toLowerCase().includes(filter));
  if (!filtered.length) { list.innerHTML = `<div style="color:var(--muted);font-size:14px;">${materialDB.length === 0 ? 'Inga material sparade √§nnu.' : 'Inga tr√§ffar.'}</div>`; return; }
  const cats = {};
  filtered.forEach(m => { const k = m.kategori || '√ñvrigt'; if (!cats[k]) cats[k] = []; cats[k].push(m); });
  list.innerHTML = '';
  Object.entries(cats).sort().forEach(([kat, items]) => {
    const ch = document.createElement('div'); ch.className = 'cat-head'; ch.textContent = kat; list.appendChild(ch);
    items.forEach(m => {
      const row = document.createElement('div'); row.className = 'db-row';
      row.innerHTML = `<div style="flex:1"><div style="font-size:14px;">${escHtml(m.namn)}</div><div style="font-size:12px;color:var(--muted);">${m.pris} kr / ${m.enhet}</div></div>
        <button class="btn btn-ghost btn-sm" onclick="laggTillFranDB('${m.id}')">+ Kalkyl</button>
        <button class="btn btn-danger btn-sm" onclick="taBortDBMat('${m.id}')">‚úï</button>`;
      list.appendChild(row);
    });
  });
}

function laggTillFranDB(id) { const m = materialDB.find(x => x.id === id); if (m) { laggTillKalkylMat({ namn: m.namn, enhet: m.enhet, pris: m.pris }); byggShowPage('kalkyl'); } }

async function taBortDBMat(id) {
  const m = materialDB.find(x => x.id === id);
  if (!confirm('Ta bort "' + (m?.namn||'') + '" fr√•n databasen?')) return;
  const { error } = await sb.from('material').delete().eq('id', id);
  if (error) { showToast('Fel: ' + error.message, 'error'); return; }
  materialDB = materialDB.filter(x => x.id !== id);
  renderDB();
  showToast('‚úì Material borttaget');
}

// ===== BER√ÑKNING =====
function rakna() {
  const timmar = parseFloat(document.getElementById('timmar').value) || 0;
  const timpris = parseFloat(document.getElementById('timpris').value) || 650;
  const rotAktiv = document.getElementById('rot-toggle').checked;
  const rotPersoner = parseInt(document.getElementById('rot-personer')?.value || 1);

  document.getElementById('rot-info').style.display = rotAktiv ? 'block' : 'none';
  document.getElementById('rot-rad').style.display = rotAktiv ? 'flex' : 'none';
  document.getElementById('max-rot-text').textContent = (rotPersoner * 50000).toLocaleString('sv-SE') + ' kr';

  const matKostnad = kalkylMat.reduce((sum, m) => sum + (m.antal * m.pris), 0);
  const arbetskostnad = timmar * timpris;
  const totalt = matKostnad + arbetskostnad;
  const maxRot = rotPersoner * 50000;
  const rotBelopp = rotAktiv ? Math.min(arbetskostnad * 0.30, maxRot) : 0;
  const finalPris = totalt - rotBelopp;

  document.getElementById('s-material').textContent = fmt(matKostnad);
  document.getElementById('s-arbete').textContent = fmt(arbetskostnad);
  document.getElementById('s-total').textContent = fmt(totalt);
  document.getElementById('s-rot').textContent = fmt(rotBelopp);
  document.getElementById('s-final').textContent = fmt(finalPris);
}

// ===== SPARA OFFERT =====
async function sparaOffert() {
  const btn = document.getElementById('spara-btn');
  btn.innerHTML = '<span class="spinner"></span>';
  btn.disabled = true;

  const offertData = {
    user_id: currentUser.id,
    offert_nr: document.getElementById('offert-nr').value,
    kund_namn: document.getElementById('kund-namn').value,
    kund_adress: document.getElementById('kund-adress').value,
    arbetsteg: arbetsteg,
    kalkyl_material: kalkylMat,
    timmar: parseFloat(document.getElementById('timmar').value) || 0,
    rot_aktiv: document.getElementById('rot-toggle').checked,
    rot_personer: parseInt(document.getElementById('rot-personer').value || 1),
    giltig: document.getElementById('offert-giltig').value
  };

  let error;
  if (window._redigerarId) {
    ({ error } = await sb.from('offerter').update(offertData).eq('id', window._redigerarId));
    if (!error) { window._redigerarId = null; btn.innerHTML = 'üíæ Spara'; showToast('‚úì Offert uppdaterad'); }
  } else {
    ({ error } = await sb.from('offerter').insert(offertData));
    if (!error) showToast('‚úì Offert sparad');
  }

  btn.innerHTML = window._redigerarId ? 'üíæ Uppdatera' : 'üíæ Spara';
  btn.disabled = false;
  if (error) { showToast('Fel: ' + error.message, 'error'); return; }
}

let sparadeCache = [];

async function laddaSparadeOfferter() {
  document.getElementById('sparade-list').innerHTML = '<div style="color:var(--muted);font-size:14px;">Laddar...</div>';
  const { data, error } = await sb.from('offerter').select('*').eq('user_id', currentUser.id).order('skapad_at', { ascending: false });
  sparadeCache = data || [];
  if (error || !sparadeCache.length) { document.getElementById('sparade-list').innerHTML = '<div style="color:var(--muted);font-size:14px;">Inga sparade offerter √§nnu.</div>'; return; }
  renderSparade(sparadeCache);
}

function filterSparade() {
  const q = (document.getElementById('sparade-filter')?.value || '').toLowerCase();
  const filtered = sparadeCache.filter(o =>
    (o.kund_namn||'').toLowerCase().includes(q) || (o.offert_nr||'').toLowerCase().includes(q)
  );
  renderSparade(filtered);
}

function renderSparade(offerter) {
  if (!offerter.length) { document.getElementById('sparade-list').innerHTML = '<div style="color:var(--muted);font-size:14px;">Inga tr√§ffar.</div>'; return; }
  document.getElementById('sparade-list').innerHTML = offerter.map(o => `
    <div class="offert-list-row">
      <div style="flex:1;cursor:pointer;" onclick="oppnaOffert('${o.id}')">
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="offert-list-nr">${escHtml(o.offert_nr||'‚Äì')}</div>
          <div class="offert-list-kund">${escHtml(o.kund_namn||'Ok√§nd kund')}</div>
        </div>
        <div class="offert-list-datum" style="margin-top:2px;padding-left:0;">${new Date(o.skapad_at).toLocaleDateString('sv-SE')}</div>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="redigeraOffert('${o.id}')" title="Redigera">‚úèÔ∏è</button>
      <button class="btn btn-danger btn-sm" onclick="taBortOffert('${o.id}')" title="Ta bort">‚úï</button>
    </div>`).join('');
}

async function oppnaOffert(id) {
  const o = sparadeCache.find(x => x.id === id);
  if (!o) { showToast('Kunde inte √∂ppna offert', 'error'); return; }
  laddaOffertIKalkyl(o);
  skapaOffert();
  byggShowPage('offert');
}

async function redigeraOffert(id) {
  const o = sparadeCache.find(x => x.id === id);
  if (!o) return;
  laddaOffertIKalkyl(o);
  // Spara id s√• vi kan uppdatera ist√§llet f√∂r att skapa ny
  window._redigerarId = id;
  document.getElementById('spara-btn').textContent = 'üíæ Uppdatera';
  byggShowPage('kalkyl');
  showToast('Offert laddad ‚Äî g√∂r √§ndringar och tryck Uppdatera');
}

function laddaOffertIKalkyl(data) {
  arbetsteg = data.arbetsteg || [];
  kalkylMat = data.kalkyl_material || [];
  document.getElementById('kund-namn').value = data.kund_namn || '';
  document.getElementById('kund-adress').value = data.kund_adress || '';
  document.getElementById('offert-nr').value = data.offert_nr || '';
  document.getElementById('offert-giltig').value = data.giltig || '';
  document.getElementById('timmar').value = data.timmar || '';
  document.getElementById('rot-toggle').checked = data.rot_aktiv || false;
  document.getElementById('rot-personer').value = data.rot_personer || 1;
  renderArbetsteg();
  renderKalkylMat();
  rakna();
}

async function taBortOffert(id) {
  const o = sparadeCache.find(x => x.id === id);
  if (!confirm(`Ta bort offert ${o?.offert_nr || ''} f√∂r ${o?.kund_namn || 'ok√§nd kund'}?`)) return;
  const { error } = await sb.from('offerter').delete().eq('id', id);
  if (error) { showToast('Fel: ' + error.message, 'error'); return; }
  sparadeCache = sparadeCache.filter(x => x.id !== id);
  renderSparade(sparadeCache);
  showToast('‚úì Offert borttagen');
}

// ===== OFFERT GENERERING =====
function skapaOffert() {
  const inst = getInst();
  const kundNamn = document.getElementById('kund-namn').value || 'Kund';
  const kundAdress = document.getElementById('kund-adress').value || '';
  const offertNr = document.getElementById('offert-nr').value || new Date().getFullYear() + '-001';
  const giltig = document.getElementById('offert-giltig').value || '30 dagar fr√•n offertdatum';
  const timmar = parseFloat(document.getElementById('timmar').value) || 0;
  const timpris = parseFloat(document.getElementById('timpris').value) || 650;
  const rotAktiv = document.getElementById('rot-toggle').checked;
  const rotPersoner = parseInt(document.getElementById('rot-personer')?.value || 1);

  const matKostnad = kalkylMat.reduce((sum, m) => sum + (m.antal * m.pris), 0);
  const arbetskostnad = timmar * timpris;
  const totalt = matKostnad + arbetskostnad;
  const maxRot = rotPersoner * 50000;
  const rotBelopp = rotAktiv ? Math.min(arbetskostnad * 0.30, maxRot) : 0;
  const finalPris = totalt - rotBelopp;
  const today = new Date().toLocaleDateString('sv-SE');

  const stegHTML = arbetsteg.filter(s => s.trim()).map(s => `<li>${escHtml(s)}</li>`).join('');
  const matListHTML = kalkylMat.filter(m => m.namn).map(m => `${escHtml(m.namn)} (${m.antal} ${m.enhet})`).join(', ');
  const logoHTML = logoBase64
    ? `<img src="${logoBase64}" style="max-height:60px;max-width:180px;object-fit:contain;display:block;margin-bottom:4px;">`
    : `<div class="offer-company">${escHtml(inst.foretag_namn || 'Ditt Bygg AB')}</div>`;

  const matRad = matKostnad > 0 ? `<tr><td class="label">Material (inkl. moms)</td><td class="val">${fmt(matKostnad)}</td></tr>` : '';
  const rotRader = rotAktiv ? `
    <tr><td class="label">Totalt f√∂re ROT-avdrag</td><td class="val">${fmt(totalt)}</td></tr>
    <tr><td class="label" style="color:#2980b9;">ROT-avdrag (‚Äì)</td><td class="val" style="color:#2980b9;">‚Äì${fmt(rotBelopp)}</td></tr>` : '';
  const rotNote = rotAktiv ? `<div class="offer-rot-note"><strong>ROT-avdrag:</strong> Avdraget p√• ${fmt(rotBelopp)} s√∂ks av utf√∂raren hos Skatteverket och dras direkt fr√•n det belopp du som kund betalar. F√∂ruts√§tter att du har utrymme f√∂r ROT-avdrag.</div>` : '';

  document.getElementById('offert-preview').innerHTML = `
    <div class="offer-header">
      <div>${logoHTML}
        <div class="offer-company-sub">${escHtml(inst.foretag_adress||'')}</div>
        ${inst.foretag_tel ? `<div class="offer-company-sub">Tel: ${escHtml(inst.foretag_tel)}</div>` : ''}
        ${inst.foretag_email ? `<div class="offer-company-sub">${escHtml(inst.foretag_email)}</div>` : ''}
        ${inst.foretag_org ? `<div class="offer-company-sub">Org.nr: ${escHtml(inst.foretag_org)}</div>` : ''}
      </div>
      <div class="offer-nr">OFFERT<strong>${escHtml(offertNr)}</strong><div style="margin-top:6px;font-size:12px;">${today}</div></div>
    </div>
    <div class="offer-section"><h3>Kund</h3>
      <div class="offer-customer"><strong>${escHtml(kundNamn)}</strong></div>
      <div class="offer-customer" style="color:#555;font-size:14px;">${escHtml(kundAdress)}</div>
    </div>
    ${stegHTML ? `<div class="offer-section"><h3>Arbetet omfattar</h3><ul class="offer-steps">${stegHTML}</ul></div>` : ''}
    ${matListHTML ? `<div class="offer-section"><h3>Material som ing√•r i priset</h3><div class="offer-materials">${matListHTML}</div></div>` : ''}
    <div class="offer-section"><h3>Priss√§ttning</h3>
      <table class="offer-price-table">
        ${matRad}
        <tr><td class="label">Fast pris f√∂r arbetskostnad (inkl. moms)</td><td class="val">${fmt(arbetskostnad)}</td></tr>
        ${rotRader}
        <tr class="offer-total-row"><td class="label">Ni betalar totalt</td><td class="val">${fmt(finalPris)}</td></tr>
      </table>${rotNote}
    </div>
    <div class="offer-section"><h3>Villkor</h3>
      <div class="offer-conditions">${(inst.villkor||'').replace(/\n/g,'<br>')}</div>
    </div>
    <div class="offer-validity">Offerten √§r giltig: ${escHtml(giltig)}</div>
    <div class="offer-footer" style="margin-top:16px;">${escHtml(inst.foretag_namn||'')}${inst.foretag_org?' ¬∑ Org.nr '+escHtml(inst.foretag_org):''}${inst.foretag_webb?' ¬∑ '+escHtml(inst.foretag_webb):''}</div>`;

  byggShowPage('offert');
}

function nollstallKalkyl() {
  arbetsteg = []; kalkylMat = [];
  ['kund-namn','kund-adress','offert-giltig','timmar'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('rot-toggle').checked = false;
  renderArbetsteg(); renderKalkylMat(); rakna();
  const yr = new Date().getFullYear();
  document.getElementById('offert-nr').value = yr + '-001';
  laggTillSteg();
  byggShowPage('kalkyl');
}

function kopieraText() {
  navigator.clipboard.writeText(document.getElementById('offert-preview').innerText)
    .then(() => showToast('‚úì Kopierat till urklipp'));
}
</script>

  </div>
</div>

<!-- SETTINGS -->
<div class="panel" id="panel-settings">
  <div class="settings-scroll">
    <div class="settings-card">
      <h3>Din profil</h3>
      <div class="setting-row"><label>Namn</label><input type="text" id="s-name" placeholder="T.ex. Erik"></div>
      <div class="setting-row"><label>Plats</label><input type="text" id="s-location" value="Fr√∂s√∂n, √ñstersund"></div>
      <div class="setting-row"><label>Extra info (p√•verkar AI-svaren)</label><textarea id="s-extra" placeholder="T.ex. 10 anst√§llda i byggf√∂retaget, hyr ut 5 l√§genheter..."></textarea></div>
      <button class="save-settings-btn" onclick="saveSettings()">üíæ Spara inst√§llningar</button>
    </div>
    <div class="settings-card">
      <h3>Om appen & Installation</h3>
      <div style="font-size:.75rem;color:var(--muted);line-height:1.9">
        <b style="color:var(--accent)">iPhone (Safari):</b> Tryck dela-ikonen ‚Üí "L√§gg till p√• hemsk√§rmen"<br>
        <b style="color:var(--accent)">Android (Chrome):</b> Tryck ‚ãÆ-menyn ‚Üí "L√§gg till p√• startsk√§rmen"<br><br>
        <b style="color:var(--text)">Live BTC-data:</b> H√§mtas fr√•n CoinGecko (gratis)<br>
        <b style="color:var(--text)">API-nyckel:</b> Skaffa gratis p√• console.groq.com<br><br>
        <b style="color:var(--text)">OBS om pushnotiser:</b> Webbl√§sarbaserade notiser fungerar bara n√§r appen √§r √∂ppen eller installerad som PWA. F√∂r garanterade dagliga notiser rekommenderas att spara appen p√• hemsk√§rmen.
      </div>
    </div>
  </div>
</div>

<div class="api-bar">
  <label>GROQ:</label>
  <input type="password" class="api-key-input" id="apiKey" placeholder="gsk_...">
  <button class="save-key-btn" onclick="saveKey()">Spara</button>
  <span id="keyStatus" style="font-size:.63rem;color:var(--muted)"></span>
  <label style="margin-left:6px;flex-shrink:0">TAAPI:</label>
  <input type="password" class="api-key-input" id="taapiKey" placeholder="eyJ...">
  <button class="save-key-btn" onclick="saveTaapiKey()">Spara</button>
  <span id="taapiStatus" style="font-size:.63rem;color:var(--muted)"></span>
</div>

<script>
let apiKey = localStorage.getItem('ai_api_key') || '';
let taapiKey = localStorage.getItem('taapi_key') || '';
let indicatorData = {};
let chatHistory = [];
let btcData = null;
let notifEnabled = false;
let notifTimer = null;
let deferredPrompt = null;

const CHAT_SYSTEM = () => {
  const s = getSettings();
  return `Du √§r en personlig AI-assistent f√∂r ${s.name || 'en f√∂retagare'} som bor p√• ${s.location || 'Fr√∂s√∂n, √ñstersund'}.
Bakgrund:
- Driver ett byggf√∂retag i √ñstersundstrakten
- Hyr ut l√§genheter
- Handlar Bitcoin dagligen (aktiv daytrader)
- K√∂r Ford F150 2008
${s.extra ? '- ' + s.extra : ''}
Svara alltid p√• svenska. Var konkret och direkt.`;
};

window.addEventListener('load', () => {
  if (apiKey) { document.getElementById('apiKey').value = apiKey; document.getElementById('keyStatus').textContent = '‚úì Sparad'; }
  if (taapiKey) { document.getElementById('taapiKey').value = taapiKey; document.getElementById('taapiStatus').textContent = '‚úì Sparad'; }
  loadSettings();
  fetchBTCData();
  checkNotifStatus();
  setInterval(fetchBTCData, 60000);
});

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault(); deferredPrompt = e;
  document.getElementById('installBtn').classList.add('visible');
});

async function installApp() {
  if (!deferredPrompt) { alert('Installationsguide:\niPhone Safari: Dela-knapp ‚Üí "L√§gg till p√• hemsk√§rmen"\nAndroid Chrome: ‚ãÆ-meny ‚Üí "L√§gg till p√• startsk√§rmen"'); return; }
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  document.getElementById('installBtn').classList.remove('visible');
  deferredPrompt = null;
}

function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  const map = { chat: 0, btc: 1, bygg: 2, settings: 3 };
  document.querySelectorAll('.tab')[map[tab]].classList.add('active');
  const panelId = { chat: 'panel-chat', btc: 'panel-btc', bygg: 'panel-bygg', settings: 'panel-settings' };
  document.getElementById(panelId[tab]).classList.add('active');
}

function saveKey() {
  apiKey = document.getElementById('apiKey').value.trim();
  localStorage.setItem('ai_api_key', apiKey);
  document.getElementById('keyStatus').textContent = apiKey ? '‚úì Sparad!' : 'Borttagen';
}

function saveTaapiKey() {
  taapiKey = document.getElementById('taapiKey').value.trim();
  localStorage.setItem('taapi_key', taapiKey);
  document.getElementById('taapiStatus').textContent = taapiKey ? '‚úì Sparad!' : 'Borttagen';
}

function getSettings() { return JSON.parse(localStorage.getItem('user_settings') || '{}'); }
function loadSettings() {
  const s = getSettings();
  if (s.name) document.getElementById('s-name').value = s.name;
  if (s.location) document.getElementById('s-location').value = s.location;
  if (s.extra) document.getElementById('s-extra').value = s.extra;
}
function saveSettings() {
  localStorage.setItem('user_settings', JSON.stringify({
    name: document.getElementById('s-name').value,
    location: document.getElementById('s-location').value,
    extra: document.getElementById('s-extra').value
  }));
  alert('‚úì Inst√§llningar sparade!');
}

async function fetchIndicators() {
  if (!taapiKey) {
    document.getElementById('ind-status').textContent = 'Ange Taapi-nyckel i f√§ltet nedan f√∂r att h√§mta indikatorer.';
    return;
  }
  const btn = document.getElementById('indBtn');
  btn.textContent = '‚è≥';
  document.getElementById('ind-status').textContent = 'H√§mtar indikatorer...';

  const symbol = 'BTC/USDT';
  const exchange = 'binance';
  const interval = '1d';
  const base = 'https://api.taapi.io';

  try {
    // Bulk request to minimize API calls (free plan: 1 req/15s)
    const bulk = await fetch(`${base}/bulk`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        secret: taapiKey,
        construct: {
          exchange, symbol, interval,
          indicators: [
            { id: 'ema20', indicator: 'ema', period: 20 },
            { id: 'ema50', indicator: 'ema', period: 50 },
            { id: 'ema200', indicator: 'ema', period: 200 },
            { id: 'macd', indicator: 'macd' },
            { id: 'bbands', indicator: 'bbands' }
          ]
        }
      })
    });
    const data = await bulk.json();

    if (data.error) throw new Error(data.error);

    const results = {};
    (data.data || []).forEach(r => { results[r.id] = r.result; });
    indicatorData = results;

    const fmt = v => v ? '$' + Math.round(v).toLocaleString('sv-SE') : '‚Äî';
    const fmtSmall = v => v ? v.toFixed(1) : '‚Äî';

    const ema20 = results.ema20?.value;
    const ema50 = results.ema50?.value;
    const ema200 = results.ema200?.value;
    const price = btcData?.market_data?.current_price?.usd || 0;

    const emaColor = (ema) => {
      if (!ema || !price) return '';
      return price > ema ? 'up' : 'down';
    };

    document.getElementById('i-ema20').textContent = fmt(ema20);
    document.getElementById('i-ema20').className = 'val ' + emaColor(ema20);
    document.getElementById('i-ema50').textContent = fmt(ema50);
    document.getElementById('i-ema50').className = 'val ' + emaColor(ema50);
    document.getElementById('i-ema200').textContent = fmt(ema200);
    document.getElementById('i-ema200').className = 'val ' + emaColor(ema200);

    const macd = results.macd?.valueMACD;
    const signal = results.macd?.valueMACDSignal;
    document.getElementById('i-macd').textContent = fmtSmall(macd);
    document.getElementById('i-macd').className = 'val ' + (macd > 0 ? 'up' : 'down');
    document.getElementById('i-signal').textContent = fmtSmall(signal);
    document.getElementById('i-signal').className = 'val ' + (signal > 0 ? 'up' : 'down');

    document.getElementById('i-bb-upper').textContent = fmt(results.bbands?.valueUpperBand);
    document.getElementById('i-bb-mid').textContent = fmt(results.bbands?.valueMiddleBand);
    document.getElementById('i-bb-lower').textContent = fmt(results.bbands?.valueLowerBand);

    document.getElementById('ind-status').textContent = 'Uppdaterad ' + new Date().toLocaleTimeString('sv-SE', {hour:'2-digit',minute:'2-digit'});
  } catch(e) {
    document.getElementById('ind-status').textContent = 'Fel: ' + (e.message || 'Kontrollera din Taapi-nyckel');
  }
  btn.textContent = '‚Üª H√§mta';
}

async function fetchBTCData() {
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin?localization=false&tickers=false&community_data=false&developer_data=false');
    const d = await res.json();
    btcData = d;
    const m = d.market_data;
    const price = m.current_price.usd;
    const change = m.price_change_percentage_24h;
    document.getElementById('t-price').textContent = '$' + price.toLocaleString('sv-SE');
    const cel = document.getElementById('t-change');
    cel.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
    cel.className = 'val ' + (change >= 0 ? 'up' : 'down');
    document.getElementById('t-vol').textContent = '$' + (m.total_volume.usd / 1e9).toFixed(1) + 'B';
    document.getElementById('t-mcap').textContent = '$' + (m.market_cap.usd / 1e12).toFixed(2) + 'T';
    document.getElementById('t-high').textContent = '$' + m.high_24h.usd.toLocaleString('sv-SE');
    document.getElementById('t-low').textContent = '$' + m.low_24h.usd.toLocaleString('sv-SE');
    const now = new Date();
    document.getElementById('lastUpdate').textContent = 'Uppdaterad ' + now.toLocaleTimeString('sv-SE', {hour:'2-digit',minute:'2-digit'});
  } catch(e) {
    document.getElementById('lastUpdate').textContent = 'Kunde ej h√§mta data';
  }
}

function buildAnalysisPrompt() {
  const m = btcData?.market_data;
  const price = m ? m.current_price.usd : 'ok√§nt';
  const change = m ? m.price_change_percentage_24h?.toFixed(2) + '%' : 'ok√§nt';
  const high = m ? '$' + m.high_24h.usd.toLocaleString() : 'ok√§nt';
  const low = m ? '$' + m.low_24h.usd.toLocaleString() : 'ok√§nt';
  const vol = m ? '$' + (m.total_volume.usd / 1e9).toFixed(1) + 'B' : 'ok√§nt';
  const buyprice = document.getElementById('p-buyprice').value;
  const amount = document.getElementById('p-amount').value;
  const stoploss = document.getElementById('p-stoploss').value;
  const takeprofit = document.getElementById('p-takeprofit').value;
  const rsi = document.getElementById('p-rsi').value;
  const horizon = document.getElementById('p-horizon').value;
  const notes = document.getElementById('p-notes').value;
  const inclNews = document.getElementById('p-news').checked;
  const inclPnl = document.getElementById('p-pnl').checked;
  const inclRisk = document.getElementById('p-risk').checked;

  let prompt = `G√∂r en daglig BTC-analys f√∂r en aktiv daytrader i Sverige. Datum: ${new Date().toLocaleDateString('sv-SE')}.

LIVE MARKNADSDATA:
- Aktuellt pris: $${typeof price === 'number' ? price.toLocaleString() : price}
- 24h f√∂r√§ndring: ${change}
- 24h H√∂g: ${high} | L√•g: ${low}
- 24h Volym: ${vol}`;
  if (rsi) prompt += `\n- RSI (14): ${rsi}`;
  prompt += `\n- Handelshorisont: ${horizon}`;
  if (buyprice || amount) {
    prompt += `\n\nMIN POSITION:`;
    if (buyprice) prompt += `\n- K√∂ppris: $${Number(buyprice).toLocaleString()}`;
    if (amount) prompt += `\n- Storlek: ${amount} BTC`;
    if (stoploss) prompt += `\n- Stop-loss: $${Number(stoploss).toLocaleString()}`;
    if (takeprofit) prompt += `\n- Take-profit: $${Number(takeprofit).toLocaleString()}`;
  }
  if (notes) prompt += `\n\nEXTRA KONTEXT:\n${notes}`;
  prompt += `\n\nAnalysera och inkludera:\n1. üìä Marknadsl√§ge & trend\n2. üéØ Rekommendation (k√∂p/h√•ll/s√§lj) med motivering`;
  if (inclPnl && buyprice && amount) prompt += `\n3. üí∞ P&L-kalkyl`;
  if (inclRisk) prompt += `\n4. ‚ö†Ô∏è Risker att bevaka idag`;
  if (inclNews) prompt += `\n5. üì∞ Marknadsfaktorer & sentiment`;
  // Add indicator data if available
  if (Object.keys(indicatorData).length > 0) {
    prompt += `\n\nTEKNISKA INDIKATORER (automatiskt h√§mtade):`;
    if (indicatorData.ema20?.value) prompt += `\n- EMA 20: $${Math.round(indicatorData.ema20.value).toLocaleString()}`;
    if (indicatorData.ema50?.value) prompt += `\n- EMA 50: $${Math.round(indicatorData.ema50.value).toLocaleString()}`;
    if (indicatorData.ema200?.value) prompt += `\n- EMA 200: $${Math.round(indicatorData.ema200.value).toLocaleString()}`;
    if (indicatorData.macd?.valueMACD) prompt += `\n- MACD: ${indicatorData.macd.valueMACD.toFixed(2)}`;
    if (indicatorData.macd?.valueMACDSignal) prompt += `\n- MACD Signal: ${indicatorData.macd.valueMACDSignal.toFixed(2)}`;
    if (indicatorData.macd?.valueMACDHist) prompt += `\n- MACD Histogram: ${indicatorData.macd.valueMACDHist.toFixed(2)}`;
    if (indicatorData.bbands?.valueUpperBand) prompt += `\n- Bollinger √ñvre: $${Math.round(indicatorData.bbands.valueUpperBand).toLocaleString()}`;
    if (indicatorData.bbands?.valueMiddleBand) prompt += `\n- Bollinger Mitten: $${Math.round(indicatorData.bbands.valueMiddleBand).toLocaleString()}`;
    if (indicatorData.bbands?.valueLowerBand) prompt += `\n- Bollinger Nedre: $${Math.round(indicatorData.bbands.valueLowerBand).toLocaleString()}`;
  }

  prompt += `\n\nVar konkret, kortfattad och direkt. Svara p√• svenska.`;
  return prompt;
}

async function callClaude(messages, maxTokens = 1200, system = null) {
  const body = { model: 'llama-3.3-70b-versatile', max_tokens: maxTokens, messages };
  if (system) body.messages = [{ role: 'system', content: system }, ...messages];
  const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + apiKey },
    body: JSON.stringify(body)
  });
  const d = await res.json();
  // Normalize to same shape as before
  if (d.choices?.[0]) return { content: [{ text: d.choices[0].message.content }] };
  return { error: { message: d.error?.message || 'Ok√§nt fel' } };
}

async function runAnalysis() {
  if (!apiKey) { alert('Ange din Groq API-nyckel l√§ngst ner. Skaffa gratis p√• console.groq.com'); return; }
  const btn = document.getElementById('analyzeBtn');
  const result = document.getElementById('btcResult');
  const useWebSearch = document.getElementById('p-websearch').checked;
  btn.disabled = true;
  result.innerHTML = '<span class="result-placeholder">AI analyserar marknaden...</span>';

  let newsContext = '';

  // Step 1: Fetch news if enabled
  if (useWebSearch) {
    btn.textContent = 'üîç S√∂ker nyheter...';
    try {
      const newsRes = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + apiKey },
        body: JSON.stringify({
          model: 'compound-beta',
          max_tokens: 600,
          messages: [{
            role: 'user',
            content: `S√∂k efter de senaste Bitcoin-nyheterna och marknadsh√§ndelserna idag (${new Date().toLocaleDateString('sv-SE')}). Sammanfatta de viktigaste punkterna p√• svenska i max 5 meningar.`
          }]
        })
      }).then(r => r.json());

      if (newsRes.choices?.[0]?.message?.content) {
        newsContext = '\n\nAKTUELLA NYHETER (automatiskt h√§mtade):\n' + newsRes.choices[0].message.content;
        // Show news sources if available
        const sources = newsRes.choices?.[0]?.message?.tool_results;
        if (sources) console.log('News sources:', sources);
      }
    } catch(e) {
      newsContext = '\n\n(Nyhetss√∂kning misslyckades ‚Äî forts√§tter utan nyheter)';
    }
  }

  // Step 2: Run analysis with news context
  btn.textContent = '‚è≥ Analyserar...';
  try {
    const prompt = buildAnalysisPrompt() + newsContext;
    const data = await callClaude([{ role: 'user', content: prompt }]);
    if (data.content?.[0]) {
      result.textContent = data.content[0].text;
      localStorage.setItem('last_analysis', data.content[0].text);
    } else { result.textContent = 'Fel: ' + (data.error?.message || 'Ok√§nt'); }
  } catch(e) { result.textContent = 'N√•got gick fel. Kontrollera API-nyckel och internetanslutning.'; }

  btn.disabled = false; btn.textContent = '‚ñ∂ K√∂r daglig BTC-analys';
}

function checkNotifStatus() {
  const saved = localStorage.getItem('notif_time');
  if (saved) document.getElementById('notifTime').value = saved;
  notifEnabled = localStorage.getItem('notif_enabled') === 'true';
  updateNotifUI();
  if (notifEnabled) scheduleNotif();
}

async function toggleNotifications() {
  if (notifEnabled) {
    notifEnabled = false; localStorage.setItem('notif_enabled', 'false');
    if (notifTimer) clearTimeout(notifTimer);
    updateNotifUI(); return;
  }
  if (!('Notification' in window)) { alert('Din webbl√§sare st√∂der inte pushnotiser. Installera appen p√• telefonen.'); return; }
  const perm = await Notification.requestPermission();
  if (perm !== 'granted') { document.getElementById('notifStatus').textContent = '‚úó Notiser nekade ‚Äî till√•t i webbl√§sarinst√§llningarna'; return; }
  notifEnabled = true;
  localStorage.setItem('notif_enabled', 'true');
  localStorage.setItem('notif_time', document.getElementById('notifTime').value);
  scheduleNotif(); updateNotifUI();
}

function updateNotifUI() {
  const btn = document.getElementById('notifBtn');
  const status = document.getElementById('notifStatus');
  if (notifEnabled) {
    btn.textContent = '‚úì Avaktivera'; btn.classList.add('enabled');
    status.textContent = `Aktiv ‚Äî analys kl ${document.getElementById('notifTime').value} varje dag`;
    status.style.color = 'var(--green)';
  } else {
    btn.textContent = 'Aktivera notiser'; btn.classList.remove('enabled');
    status.textContent = 'Ej aktiverade'; status.style.color = 'var(--muted)';
  }
}

function scheduleNotif() {
  if (notifTimer) clearTimeout(notifTimer);
  const [h, m] = document.getElementById('notifTime').value.split(':').map(Number);
  const target = new Date(); target.setHours(h, m, 0, 0);
  if (target <= new Date()) target.setDate(target.getDate() + 1);
  notifTimer = setTimeout(async () => { await triggerDailyNotif(); scheduleNotif(); }, target - new Date());
}

async function triggerDailyNotif() {
  await fetchBTCData();
  let body = '√ñppna appen f√∂r din dagliga BTC-analys!';
  if (apiKey) {
    try {
      const p = buildAnalysisPrompt() + '\n\nGe en MYCKET kort sammanfattning (max 2 meningar) f√∂r en pushnotis.';
      const data = await callClaude([{ role: 'user', content: p }], 200);
      if (data.content?.[0]) body = data.content[0].text;
    } catch(e) {}
  }
  const price = btcData?.market_data?.current_price?.usd;
  new Notification('‚Çø Daglig BTC-analys', {
    body: (price ? '$' + price.toLocaleString('sv-SE') + ' ‚Äî ' : '') + body,
    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚Çø</text></svg>',
    tag: 'btc-daily'
  });
}

// CHAT
function handleKey(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } }

// ‚îÄ‚îÄ IMAGE HANDLING ‚îÄ‚îÄ
let currentImageB64 = null;
let currentImageType = null;

function handleImageUpload(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const dataUrl = e.target.result;
    currentImageB64 = dataUrl.split(',')[1];
    currentImageType = file.type;
    document.getElementById('img-preview-thumb').src = dataUrl;
    document.getElementById('img-preview-name').textContent = file.name;
    document.getElementById('img-preview-bar').style.display = 'block';
  };
  reader.readAsDataURL(file);
  input.value = '';
}

function clearImage() {
  currentImageB64 = null;
  currentImageType = null;
  document.getElementById('img-preview-bar').style.display = 'none';
  document.getElementById('img-preview-thumb').src = '';
}
function autoResize(el) { el.style.height = 'auto'; el.style.height = Math.min(el.scrollHeight, 110) + 'px'; }

function addMsg(role, content) {
  const msgs = document.getElementById('messages');
  const w = msgs.querySelector('.welcome-msg'); if(w) w.remove();
  const div = document.createElement('div');
  div.className = 'msg ' + role;
  div.innerHTML = `<div class="msg-avatar">${role==='ai'?'AI':'DU'}</div><div class="msg-bubble">${content.replace(/\n/g,'<br>')}</div>`;
  msgs.appendChild(div); msgs.scrollTop = msgs.scrollHeight;
}

function addThinking() {
  const msgs = document.getElementById('messages');
  const div = document.createElement('div'); div.className = 'msg ai'; div.id = 'thinking';
  div.innerHTML = `<div class="msg-avatar">AI</div><div class="msg-bubble"><div class="thinking"><span></span><span></span><span></span></div></div>`;
  msgs.appendChild(div); msgs.scrollTop = msgs.scrollHeight;
}
function removeThinking() { const t = document.getElementById('thinking'); if(t) t.remove(); }

async function sendMessage() {
  const input = document.getElementById('userInput');
  const text = input.value.trim();
  if (!text && !currentImageB64) return;
  if (!apiKey) { alert('Ange din Groq API-nyckel l√§ngst ner.'); return; }
  input.value = ''; input.style.height = 'auto';

  // Build user message content
  let userContent;
  let displayText = text || 'üìé [Bild bifogad]';

  if (currentImageB64) {
    // Vision message
    userContent = [
      { type: 'image_url', image_url: { url: `data:${currentImageType};base64,${currentImageB64}` } }
    ];
    if (text) userContent.push({ type: 'text', text });
    else userContent.push({ type: 'text', text: 'Analysera denna bild/graf. Beskriv vad du ser och ge din bed√∂mning.' });
    clearImage();
  } else {
    userContent = text;
  }

  addMsg('user', displayText);
  chatHistory.push({ role: 'user', content: userContent });
  document.getElementById('sendBtn').disabled = true; addThinking();

  try {
    // Use vision model if image, otherwise standard
    const model = Array.isArray(userContent) ? 'meta-llama/llama-4-scout-17b-16e-instruct' : 'llama-3.3-70b-versatile';
    const data = await fetch('https://api.groq.com/openai/v1/chat/completions', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + apiKey },
      body: JSON.stringify({ model, max_tokens: 1024, messages: [{ role: 'system', content: CHAT_SYSTEM() }, ...chatHistory] })
    }).then(r => r.json());
    removeThinking();
    const reply = data.choices?.[0]?.message?.content;
    if (reply) { chatHistory.push({ role: 'assistant', content: reply }); addMsg('ai', reply); }
    else addMsg('ai', 'Fel: ' + (data.error?.message || 'Ok√§nt'));
  } catch(e) { removeThinking(); addMsg('ai', 'N√•got gick fel.'); }
  document.getElementById('sendBtn').disabled = false;
  document.getElementById('userInput').focus();
}

function tryLoadBygg() {
  const iframe = document.getElementById('bygg-iframe');
  const placeholder = document.getElementById('bygg-placeholder');
  iframe.style.display = 'block';
  placeholder.style.display = 'none';
  iframe.onerror = () => { iframe.style.display = 'none'; placeholder.style.display = 'flex'; };
}

function quickSend(t) { document.getElementById('userInput').value = t; sendMessage(); }
function clearChat() {
  chatHistory = [];
  document.getElementById('messages').innerHTML = `<div class="welcome-msg"><h2>Hej! Jag √§r din AI-assistent.</h2>Jag k√§nner till ditt byggf√∂retag, dina hyresbost√§der och din Bitcoin-handel.</div>`;
}
</script>

</body>
</html>
